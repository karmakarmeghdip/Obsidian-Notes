/*
-------------------------------------------
Media DB - Release Build
-------------------------------------------
By: Moritz Jung (https://www.moritzjung.dev)
Time: Sun, 02 Jun 2024 18:13:46 GMT
Version: 0.7.0
-------------------------------------------
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
-------------------------------------------
MIT License

Copyright (c) 2024 Moritz Jung

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/

var ai=Object.defineProperty;var zo=Object.getOwnPropertyDescriptor;var Ko=Object.getOwnPropertyNames;var Xo=Object.prototype.hasOwnProperty;var Jo=(r,e,t)=>e in r?ai(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Zo=(r,e)=>{for(var t in e)ai(r,t,{get:e[t],enumerable:!0})},Qo=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Ko(e))!Xo.call(r,o)&&o!==t&&ai(r,o,{get:()=>e[o],enumerable:!(i=zo(e,o))||i.enumerable});return r};var en=r=>Qo(ai({},"__esModule",{value:!0}),r);var X=(r,e,t)=>(Jo(r,typeof e!="symbol"?e+"":e,t),t);var ca={};Zo(ca,{default:()=>zi});module.exports=en(ca);var K=require("obsidian");var C=require("obsidian");var uo=require("obsidian");var co=require("obsidian");var B="top",V="bottom",j="right",I="left",si="auto",je=[B,V,j,I],Re="start",Ke="end",Nr="clippingParents",li="viewport",bt="popper",Br="reference",Ki=je.reduce(function(r,e){return r.concat([e+"-"+Re,e+"-"+Ke])},[]),pi=[].concat(je,[si]).reduce(function(r,e){return r.concat([e,e+"-"+Re,e+"-"+Ke])},[]),tn="beforeRead",rn="read",on="afterRead",nn="beforeMain",an="main",sn="afterMain",ln="beforeWrite",pn="write",dn="afterWrite",Ir=[tn,rn,on,nn,an,sn,ln,pn,dn];function J(r){return r?(r.nodeName||"").toLowerCase():null}function k(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var e=r.ownerDocument;return e&&e.defaultView||window}return r}function de(r){var e=k(r).Element;return r instanceof e||r instanceof Element}function G(r){var e=k(r).HTMLElement;return r instanceof e||r instanceof HTMLElement}function wt(r){if(typeof ShadowRoot=="undefined")return!1;var e=k(r).ShadowRoot;return r instanceof e||r instanceof ShadowRoot}function cn(r){var e=r.state;Object.keys(e.elements).forEach(function(t){var i=e.styles[t]||{},o=e.attributes[t]||{},n=e.elements[t];!G(n)||!J(n)||(Object.assign(n.style,i),Object.keys(o).forEach(function(a){var s=o[a];s===!1?n.removeAttribute(a):n.setAttribute(a,s===!0?"":s)}))})}function un(r){var e=r.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(i){var o=e.elements[i],n=e.attributes[i]||{},a=Object.keys(e.styles.hasOwnProperty(i)?e.styles[i]:t[i]),s=a.reduce(function(l,p){return l[p]="",l},{});!G(o)||!J(o)||(Object.assign(o.style,s),Object.keys(n).forEach(function(l){o.removeAttribute(l)}))})}}var Lr={name:"applyStyles",enabled:!0,phase:"write",fn:cn,effect:un,requires:["computeStyles"]};function Z(r){return r.split("-")[0]}var he=Math.max,Xe=Math.min,Ae=Math.round;function xt(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function jt(){return!/^((?!chrome|android).)*safari/i.test(xt())}function ce(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var i=r.getBoundingClientRect(),o=1,n=1;e&&G(r)&&(o=r.offsetWidth>0&&Ae(i.width)/r.offsetWidth||1,n=r.offsetHeight>0&&Ae(i.height)/r.offsetHeight||1);var a=de(r)?k(r):window,s=a.visualViewport,l=!jt()&&t,p=(i.left+(l&&s?s.offsetLeft:0))/o,d=(i.top+(l&&s?s.offsetTop:0))/n,c=i.width/o,f=i.height/n;return{width:c,height:f,top:d,right:p+c,bottom:d+f,left:p,x:p,y:d}}function Je(r){var e=ce(r),t=r.offsetWidth,i=r.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-i)<=1&&(i=e.height),{x:r.offsetLeft,y:r.offsetTop,width:t,height:i}}function qt(r,e){var t=e.getRootNode&&e.getRootNode();if(r.contains(e))return!0;if(t&&wt(t)){var i=e;do{if(i&&r.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function ae(r){return k(r).getComputedStyle(r)}function Xi(r){return["table","td","th"].indexOf(J(r))>=0}function ie(r){return((de(r)?r.ownerDocument:r.document)||window.document).documentElement}function Oe(r){return J(r)==="html"?r:r.assignedSlot||r.parentNode||(wt(r)?r.host:null)||ie(r)}function Wr(r){return!G(r)||ae(r).position==="fixed"?null:r.offsetParent}function mn(r){var e=/firefox/i.test(xt()),t=/Trident/i.test(xt());if(t&&G(r)){var i=ae(r);if(i.position==="fixed")return null}var o=Oe(r);for(wt(o)&&(o=o.host);G(o)&&["html","body"].indexOf(J(o))<0;){var n=ae(o);if(n.transform!=="none"||n.perspective!=="none"||n.contain==="paint"||["transform","perspective"].indexOf(n.willChange)!==-1||e&&n.willChange==="filter"||e&&n.filter&&n.filter!=="none")return o;o=o.parentNode}return null}function ge(r){for(var e=k(r),t=Wr(r);t&&Xi(t)&&ae(t).position==="static";)t=Wr(t);return t&&(J(t)==="html"||J(t)==="body"&&ae(t).position==="static")?e:t||mn(r)||e}function Ze(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function Qe(r,e,t){return he(r,Xe(e,t))}function jr(r,e,t){var i=Qe(r,e,t);return i>t?t:i}function Ut(){return{top:0,right:0,bottom:0,left:0}}function Ht(r){return Object.assign({},Ut(),r)}function Vt(r,e){return e.reduce(function(t,i){return t[i]=r,t},{})}var fn=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,Ht(typeof e!="number"?e:Vt(e,je))};function hn(r){var e,t=r.state,i=r.name,o=r.options,n=t.elements.arrow,a=t.modifiersData.popperOffsets,s=Z(t.placement),l=Ze(s),p=[I,j].indexOf(s)>=0,d=p?"height":"width";if(!(!n||!a)){var c=fn(o.padding,t),f=Je(n),u=l==="y"?B:I,M=l==="y"?V:j,g=t.rects.reference[d]+t.rects.reference[l]-a[l]-t.rects.popper[d],m=a[l]-t.rects.reference[l],_=ge(n),b=_?l==="y"?_.clientHeight||0:_.clientWidth||0:0,D=g/2-m/2,h=c[u],y=b-f[d]-c[M],w=b/2-f[d]/2+D,S=Qe(h,w,y),T=l;t.modifiersData[i]=(e={},e[T]=S,e.centerOffset=S-w,e)}}function gn(r){var e=r.state,t=r.options,i=t.element,o=i===void 0?"[data-popper-arrow]":i;o!=null&&(typeof o=="string"&&(o=e.elements.popper.querySelector(o),!o)||qt(e.elements.popper,o)&&(e.elements.arrow=o))}var qr={name:"arrow",enabled:!0,phase:"main",fn:hn,effect:gn,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function ue(r){return r.split("-")[1]}var yn={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Mn(r,e){var t=r.x,i=r.y,o=e.devicePixelRatio||1;return{x:Ae(t*o)/o||0,y:Ae(i*o)/o||0}}function Ur(r){var e,t=r.popper,i=r.popperRect,o=r.placement,n=r.variation,a=r.offsets,s=r.position,l=r.gpuAcceleration,p=r.adaptive,d=r.roundOffsets,c=r.isFixed,f=a.x,u=f===void 0?0:f,M=a.y,g=M===void 0?0:M,m=typeof d=="function"?d({x:u,y:g}):{x:u,y:g};u=m.x,g=m.y;var _=a.hasOwnProperty("x"),b=a.hasOwnProperty("y"),D=I,h=B,y=window;if(p){var w=ge(t),S="clientHeight",T="clientWidth";if(w===k(t)&&(w=ie(t),ae(w).position!=="static"&&s==="absolute"&&(S="scrollHeight",T="scrollWidth")),w=w,o===B||(o===I||o===j)&&n===Ke){h=V;var E=c&&w===y&&y.visualViewport?y.visualViewport.height:w[S];g-=E-i.height,g*=l?1:-1}if(o===I||(o===B||o===V)&&n===Ke){D=j;var x=c&&w===y&&y.visualViewport?y.visualViewport.width:w[T];u-=x-i.width,u*=l?1:-1}}var v=Object.assign({position:s},p&&yn),F=d===!0?Mn({x:u,y:g},k(t)):{x:u,y:g};if(u=F.x,g=F.y,l){var P;return Object.assign({},v,(P={},P[h]=b?"0":"",P[D]=_?"0":"",P.transform=(y.devicePixelRatio||1)<=1?"translate("+u+"px, "+g+"px)":"translate3d("+u+"px, "+g+"px, 0)",P))}return Object.assign({},v,(e={},e[h]=b?g+"px":"",e[D]=_?u+"px":"",e.transform="",e))}function vn(r){var e=r.state,t=r.options,i=t.gpuAcceleration,o=i===void 0?!0:i,n=t.adaptive,a=n===void 0?!0:n,s=t.roundOffsets,l=s===void 0?!0:s,p={placement:Z(e.placement),variation:ue(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:o,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Ur(Object.assign({},p,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:a,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Ur(Object.assign({},p,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}var Hr={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:vn,data:{}};var di={passive:!0};function bn(r){var e=r.state,t=r.instance,i=r.options,o=i.scroll,n=o===void 0?!0:o,a=i.resize,s=a===void 0?!0:a,l=k(e.elements.popper),p=[].concat(e.scrollParents.reference,e.scrollParents.popper);return n&&p.forEach(function(d){d.addEventListener("scroll",t.update,di)}),s&&l.addEventListener("resize",t.update,di),function(){n&&p.forEach(function(d){d.removeEventListener("scroll",t.update,di)}),s&&l.removeEventListener("resize",t.update,di)}}var Vr={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:bn,data:{}};var wn={left:"right",right:"left",bottom:"top",top:"bottom"};function Tt(r){return r.replace(/left|right|bottom|top/g,function(e){return wn[e]})}var xn={start:"end",end:"start"};function ci(r){return r.replace(/start|end/g,function(e){return xn[e]})}function et(r){var e=k(r),t=e.pageXOffset,i=e.pageYOffset;return{scrollLeft:t,scrollTop:i}}function tt(r){return ce(ie(r)).left+et(r).scrollLeft}function Ji(r,e){var t=k(r),i=ie(r),o=t.visualViewport,n=i.clientWidth,a=i.clientHeight,s=0,l=0;if(o){n=o.width,a=o.height;var p=jt();(p||!p&&e==="fixed")&&(s=o.offsetLeft,l=o.offsetTop)}return{width:n,height:a,x:s+tt(r),y:l}}function Zi(r){var e,t=ie(r),i=et(r),o=(e=r.ownerDocument)==null?void 0:e.body,n=he(t.scrollWidth,t.clientWidth,o?o.scrollWidth:0,o?o.clientWidth:0),a=he(t.scrollHeight,t.clientHeight,o?o.scrollHeight:0,o?o.clientHeight:0),s=-i.scrollLeft+tt(r),l=-i.scrollTop;return ae(o||t).direction==="rtl"&&(s+=he(t.clientWidth,o?o.clientWidth:0)-n),{width:n,height:a,x:s,y:l}}function it(r){var e=ae(r),t=e.overflow,i=e.overflowX,o=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+o+i)}function ui(r){return["html","body","#document"].indexOf(J(r))>=0?r.ownerDocument.body:G(r)&&it(r)?r:ui(Oe(r))}function qe(r,e){var t;e===void 0&&(e=[]);var i=ui(r),o=i===((t=r.ownerDocument)==null?void 0:t.body),n=k(i),a=o?[n].concat(n.visualViewport||[],it(i)?i:[]):i,s=e.concat(a);return o?s:s.concat(qe(Oe(a)))}function _t(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function Tn(r,e){var t=ce(r,!1,e==="fixed");return t.top=t.top+r.clientTop,t.left=t.left+r.clientLeft,t.bottom=t.top+r.clientHeight,t.right=t.left+r.clientWidth,t.width=r.clientWidth,t.height=r.clientHeight,t.x=t.left,t.y=t.top,t}function Gr(r,e,t){return e===li?_t(Ji(r,t)):de(e)?Tn(e,t):_t(Zi(ie(r)))}function _n(r){var e=qe(Oe(r)),t=["absolute","fixed"].indexOf(ae(r).position)>=0,i=t&&G(r)?ge(r):r;return de(i)?e.filter(function(o){return de(o)&&qt(o,i)&&J(o)!=="body"}):[]}function Qi(r,e,t,i){var o=e==="clippingParents"?_n(r):[].concat(e),n=[].concat(o,[t]),a=n[0],s=n.reduce(function(l,p){var d=Gr(r,p,i);return l.top=he(d.top,l.top),l.right=Xe(d.right,l.right),l.bottom=Xe(d.bottom,l.bottom),l.left=he(d.left,l.left),l},Gr(r,a,i));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function Gt(r){var e=r.reference,t=r.element,i=r.placement,o=i?Z(i):null,n=i?ue(i):null,a=e.x+e.width/2-t.width/2,s=e.y+e.height/2-t.height/2,l;switch(o){case B:l={x:a,y:e.y-t.height};break;case V:l={x:a,y:e.y+e.height};break;case j:l={x:e.x+e.width,y:s};break;case I:l={x:e.x-t.width,y:s};break;default:l={x:e.x,y:e.y}}var p=o?Ze(o):null;if(p!=null){var d=p==="y"?"height":"width";switch(n){case Re:l[p]=l[p]-(e[d]/2-t[d]/2);break;case Ke:l[p]=l[p]+(e[d]/2-t[d]/2);break;default:}}return l}function ye(r,e){e===void 0&&(e={});var t=e,i=t.placement,o=i===void 0?r.placement:i,n=t.strategy,a=n===void 0?r.strategy:n,s=t.boundary,l=s===void 0?Nr:s,p=t.rootBoundary,d=p===void 0?li:p,c=t.elementContext,f=c===void 0?bt:c,u=t.altBoundary,M=u===void 0?!1:u,g=t.padding,m=g===void 0?0:g,_=Ht(typeof m!="number"?m:Vt(m,je)),b=f===bt?Br:bt,D=r.rects.popper,h=r.elements[M?b:f],y=Qi(de(h)?h:h.contextElement||ie(r.elements.popper),l,d,a),w=ce(r.elements.reference),S=Gt({reference:w,element:D,strategy:"absolute",placement:o}),T=_t(Object.assign({},D,S)),E=f===bt?T:w,x={top:y.top-E.top+_.top,bottom:E.bottom-y.bottom+_.bottom,left:y.left-E.left+_.left,right:E.right-y.right+_.right},v=r.modifiersData.offset;if(f===bt&&v){var F=v[o];Object.keys(x).forEach(function(P){var H=[j,V].indexOf(P)>=0?1:-1,N=[B,V].indexOf(P)>=0?"y":"x";x[P]+=F[N]*H})}return x}function er(r,e){e===void 0&&(e={});var t=e,i=t.placement,o=t.boundary,n=t.rootBoundary,a=t.padding,s=t.flipVariations,l=t.allowedAutoPlacements,p=l===void 0?pi:l,d=ue(i),c=d?s?Ki:Ki.filter(function(M){return ue(M)===d}):je,f=c.filter(function(M){return p.indexOf(M)>=0});f.length===0&&(f=c);var u=f.reduce(function(M,g){return M[g]=ye(r,{placement:g,boundary:o,rootBoundary:n,padding:a})[Z(g)],M},{});return Object.keys(u).sort(function(M,g){return u[M]-u[g]})}function Sn(r){if(Z(r)===si)return[];var e=Tt(r);return[ci(r),e,ci(e)]}function Dn(r){var e=r.state,t=r.options,i=r.name;if(!e.modifiersData[i]._skip){for(var o=t.mainAxis,n=o===void 0?!0:o,a=t.altAxis,s=a===void 0?!0:a,l=t.fallbackPlacements,p=t.padding,d=t.boundary,c=t.rootBoundary,f=t.altBoundary,u=t.flipVariations,M=u===void 0?!0:u,g=t.allowedAutoPlacements,m=e.options.placement,_=Z(m),b=_===m,D=l||(b||!M?[Tt(m)]:Sn(m)),h=[m].concat(D).reduce(function($e,fe){return $e.concat(Z(fe)===si?er(e,{placement:fe,boundary:d,rootBoundary:c,padding:p,flipVariations:M,allowedAutoPlacements:g}):fe)},[]),y=e.rects.reference,w=e.rects.popper,S=new Map,T=!0,E=h[0],x=0;x<h.length;x++){var v=h[x],F=Z(v),P=ue(v)===Re,H=[B,V].indexOf(F)>=0,N=H?"width":"height",R=ye(e,{placement:v,boundary:d,rootBoundary:c,altBoundary:f,padding:p}),ee=H?P?j:I:P?V:B;y[N]>w[N]&&(ee=Tt(ee));var _e=Tt(ee),le=[];if(n&&le.push(R[F]<=0),s&&le.push(R[ee]<=0,R[_e]<=0),le.every(function($e){return $e})){E=v,T=!1;break}S.set(v,le)}if(T)for(var Se=M?3:1,gt=function(fe){var We=h.find(function(Ye){var De=S.get(Ye);if(De)return De.slice(0,fe).every(function(yt){return yt})});if(We)return E=We,"break"},Le=Se;Le>0;Le--){var Ge=gt(Le);if(Ge==="break")break}e.placement!==E&&(e.modifiersData[i]._skip=!0,e.placement=E,e.reset=!0)}}var Yr={name:"flip",enabled:!0,phase:"main",fn:Dn,requiresIfExists:["offset"],data:{_skip:!1}};function zr(r,e,t){return t===void 0&&(t={x:0,y:0}),{top:r.top-e.height-t.y,right:r.right-e.width+t.x,bottom:r.bottom-e.height+t.y,left:r.left-e.width-t.x}}function Kr(r){return[B,j,V,I].some(function(e){return r[e]>=0})}function En(r){var e=r.state,t=r.name,i=e.rects.reference,o=e.rects.popper,n=e.modifiersData.preventOverflow,a=ye(e,{elementContext:"reference"}),s=ye(e,{altBoundary:!0}),l=zr(a,i),p=zr(s,o,n),d=Kr(l),c=Kr(p);e.modifiersData[t]={referenceClippingOffsets:l,popperEscapeOffsets:p,isReferenceHidden:d,hasPopperEscaped:c},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":c})}var Xr={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:En};function Cn(r,e,t){var i=Z(r),o=[I,B].indexOf(i)>=0?-1:1,n=typeof t=="function"?t(Object.assign({},e,{placement:r})):t,a=n[0],s=n[1];return a=a||0,s=(s||0)*o,[I,j].indexOf(i)>=0?{x:s,y:a}:{x:a,y:s}}function Pn(r){var e=r.state,t=r.options,i=r.name,o=t.offset,n=o===void 0?[0,0]:o,a=pi.reduce(function(d,c){return d[c]=Cn(c,e.rects,n),d},{}),s=a[e.placement],l=s.x,p=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=p),e.modifiersData[i]=a}var Jr={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Pn};function Fn(r){var e=r.state,t=r.name;e.modifiersData[t]=Gt({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}var Zr={name:"popperOffsets",enabled:!0,phase:"read",fn:Fn,data:{}};function tr(r){return r==="x"?"y":"x"}function kn(r){var e=r.state,t=r.options,i=r.name,o=t.mainAxis,n=o===void 0?!0:o,a=t.altAxis,s=a===void 0?!1:a,l=t.boundary,p=t.rootBoundary,d=t.altBoundary,c=t.padding,f=t.tether,u=f===void 0?!0:f,M=t.tetherOffset,g=M===void 0?0:M,m=ye(e,{boundary:l,rootBoundary:p,padding:c,altBoundary:d}),_=Z(e.placement),b=ue(e.placement),D=!b,h=Ze(_),y=tr(h),w=e.modifiersData.popperOffsets,S=e.rects.reference,T=e.rects.popper,E=typeof g=="function"?g(Object.assign({},e.rects,{placement:e.placement})):g,x=typeof E=="number"?{mainAxis:E,altAxis:E}:Object.assign({mainAxis:0,altAxis:0},E),v=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,F={x:0,y:0};if(w){if(n){var P,H=h==="y"?B:I,N=h==="y"?V:j,R=h==="y"?"height":"width",ee=w[h],_e=ee+m[H],le=ee-m[N],Se=u?-T[R]/2:0,gt=b===Re?S[R]:T[R],Le=b===Re?-T[R]:-S[R],Ge=e.elements.arrow,$e=u&&Ge?Je(Ge):{width:0,height:0},fe=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Ut(),We=fe[H],Ye=fe[N],De=Qe(0,S[R],$e[R]),yt=D?S[R]/2-Se-De-We-x.mainAxis:gt-De-We-x.mainAxis,ei=D?-S[R]/2+Se+De+Ye+x.mainAxis:Le+De+Ye+x.mainAxis,Mt=e.elements.arrow&&ge(e.elements.arrow),ti=Mt?h==="y"?Mt.clientTop||0:Mt.clientLeft||0:0,$t=(P=v==null?void 0:v[h])!=null?P:0,ii=ee+yt-$t-ti,ri=ee+ei-$t,Rt=Qe(u?Xe(_e,ii):_e,ee,u?he(le,ri):le);w[h]=Rt,F[h]=Rt-ee}if(s){var At,oi=h==="x"?B:I,ni=h==="x"?V:j,Ee=w[y],ze=y==="y"?"height":"width",Ot=Ee+m[oi],Nt=Ee-m[ni],vt=[B,I].indexOf(_)!==-1,Bt=(At=v==null?void 0:v[y])!=null?At:0,It=vt?Ot:Ee-S[ze]-T[ze]-Bt+x.altAxis,Lt=vt?Ee+S[ze]+T[ze]-Bt-x.altAxis:Nt,Wt=u&&vt?jr(It,Ee,Lt):Qe(u?It:Ot,Ee,u?Lt:Nt);w[y]=Wt,F[y]=Wt-Ee}e.modifiersData[i]=F}}var Qr={name:"preventOverflow",enabled:!0,phase:"main",fn:kn,requiresIfExists:["offset"]};function ir(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function rr(r){return r===k(r)||!G(r)?et(r):ir(r)}function $n(r){var e=r.getBoundingClientRect(),t=Ae(e.width)/r.offsetWidth||1,i=Ae(e.height)/r.offsetHeight||1;return t!==1||i!==1}function or(r,e,t){t===void 0&&(t=!1);var i=G(e),o=G(e)&&$n(e),n=ie(e),a=ce(r,o,t),s={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(i||!i&&!t)&&((J(e)!=="body"||it(n))&&(s=rr(e)),G(e)?(l=ce(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):n&&(l.x=tt(n))),{x:a.left+s.scrollLeft-l.x,y:a.top+s.scrollTop-l.y,width:a.width,height:a.height}}function Rn(r){var e=new Map,t=new Set,i=[];r.forEach(function(n){e.set(n.name,n)});function o(n){t.add(n.name);var a=[].concat(n.requires||[],n.requiresIfExists||[]);a.forEach(function(s){if(!t.has(s)){var l=e.get(s);l&&o(l)}}),i.push(n)}return r.forEach(function(n){t.has(n.name)||o(n)}),i}function nr(r){var e=Rn(r);return Ir.reduce(function(t,i){return t.concat(e.filter(function(o){return o.phase===i}))},[])}function ar(r){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(r())})})),e}}function sr(r){var e=r.reduce(function(t,i){var o=t[i.name];return t[i.name]=o?Object.assign({},o,i,{options:Object.assign({},o.options,i.options),data:Object.assign({},o.data,i.data)}):i,t},{});return Object.keys(e).map(function(t){return e[t]})}var eo={placement:"bottom",modifiers:[],strategy:"absolute"};function to(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return!e.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function io(r){r===void 0&&(r={});var e=r,t=e.defaultModifiers,i=t===void 0?[]:t,o=e.defaultOptions,n=o===void 0?eo:o;return function(s,l,p){p===void 0&&(p=n);var d={placement:"bottom",orderedModifiers:[],options:Object.assign({},eo,n),modifiersData:{},elements:{reference:s,popper:l},attributes:{},styles:{}},c=[],f=!1,u={state:d,setOptions:function(_){var b=typeof _=="function"?_(d.options):_;g(),d.options=Object.assign({},n,d.options,b),d.scrollParents={reference:de(s)?qe(s):s.contextElement?qe(s.contextElement):[],popper:qe(l)};var D=nr(sr([].concat(i,d.options.modifiers)));return d.orderedModifiers=D.filter(function(h){return h.enabled}),M(),u.update()},forceUpdate:function(){if(!f){var _=d.elements,b=_.reference,D=_.popper;if(to(b,D)){d.rects={reference:or(b,ge(D),d.options.strategy==="fixed"),popper:Je(D)},d.reset=!1,d.placement=d.options.placement,d.orderedModifiers.forEach(function(x){return d.modifiersData[x.name]=Object.assign({},x.data)});for(var h=0;h<d.orderedModifiers.length;h++){if(d.reset===!0){d.reset=!1,h=-1;continue}var y=d.orderedModifiers[h],w=y.fn,S=y.options,T=S===void 0?{}:S,E=y.name;typeof w=="function"&&(d=w({state:d,options:T,name:E,instance:u})||d)}}}},update:ar(function(){return new Promise(function(m){u.forceUpdate(),m(d)})}),destroy:function(){g(),f=!0}};if(!to(s,l))return u;u.setOptions(p).then(function(m){!f&&p.onFirstUpdate&&p.onFirstUpdate(m)});function M(){d.orderedModifiers.forEach(function(m){var _=m.name,b=m.options,D=b===void 0?{}:b,h=m.effect;if(typeof h=="function"){var y=h({state:d,name:_,instance:u,options:D}),w=function(){};c.push(y||w)}})}function g(){c.forEach(function(m){return m()}),c=[]}return u}}var An=[Vr,Zr,Hr,Lr,Jr,Yr,Qr,qr,Xr],lr=io({defaultModifiers:An});var pr="obsidian-media-db-plugin",dr="m.projects.code@gmail.com",oe="mediaDB",cr="0.5.2";function oo(r,e){if(e<=0)throw Error("size may not be zero or negative");return mi(r,e)}function ur(r){return/^[a-zA-Z_]+$/.test(r)}function no(r){return r.replace(/[\\,#%&{}/*<>$"@.?]*/g,"").replace(/:+/g," -")}function mr(r,e,t=!1){return r.replace(new RegExp("{{.*?}}","g"),i=>On(i,e,t))}function On(r,e,t){let i=r;i=i.substring(2),i=i.substring(0,i.length-2),i=i.trim();let o=i.split(":");if(o.length===1){let n=o[0].split("."),a=ro(n,e);return a===void 0?t?"":"{{ INVALID TEMPLATE TAG - object undefined }}":a}else if(o.length===2){let n=o[0],a=o[1].split("."),s=ro(a,e);return s===void 0?t?"":"{{ INVALID TEMPLATE TAG - object undefined }}":n==="LIST"?Array.isArray(s)?s.map(l=>`- ${l}`).join(`
`):"{{ INVALID TEMPLATE TAG - operator LIST is only applicable on an array }}":n==="ENUM"?Array.isArray(s)?s.join(", "):"{{ INVALID TEMPLATE TAG - operator ENUM is only applicable on an array }}":n==="FIRST"?Array.isArray(s)?s[0]:"{{ INVALID TEMPLATE TAG - operator FIRST is only applicable on an array }}":n==="LAST"?Array.isArray(s)?s[s.length-1]:"{{ INVALID TEMPLATE TAG - operator LAST is only applicable on an array }}":`{{ INVALID TEMPLATE TAG - unknown operator ${n} }}`}return"{{ INVALID TEMPLATE TAG }}"}function ro(r,e){let t=e;for(let i of r)t!==void 0&&(t=t[i]);return t}function ao(r){let e=r.length;if(e===0)return"";let t=r[0].length;if(t===0)return"";for(let n of r)if(n.length!==t)return"";let i=[];for(let n=0;n<t;n++){let a=0;for(let s of r)s[n].length>a&&(a=s[n].length);i.push(a)}let o="";for(let n=0;n<e;n++){o+="|";for(let a=0;a<t;a++){let s=r[n][a];s+=" ".repeat(i[a]-s.length),o+=" "+s+" |"}if(o+=`
`,n===0){o+="|";for(let a=0;a<t;a++)o+=" "+"-".repeat(i[a])+" |";o+=`
`}}return o}function so(r){return createFragment(e=>e.createDiv().innerHTML=r)}function Nn(r){return`${r.getMonth()+1}-${r.getDate()}-${r.getFullYear()}`}function Bn(r){return`${r.getHours()}-${r.getMinutes()}-${r.getSeconds()}`}function lo(r){return`${Nn(r)} ${Bn(r)}`}function mi(r,e){return(r%e+e)%e}function fr(r){return r.charAt(0).toUpperCase()+r.slice(1)}var rt=class extends Error{constructor(e){super(e)}},Yt=class extends Error{constructor(e){super(e)}};function $(r,e,t){for(let i in r)r[i]=e.hasOwnProperty(i)?e[i]:t[i]}function zt(r){return r.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/\b([A-Z]+)([A-Z])([a-z])/,"$1 $2$3").replace(/^./,function(e){return e.toUpperCase()})}function hr(r){return!!r.plugins.plugins["templater-obsidian"]}async function po(r,e){let t=r.plugins.plugins["templater-obsidian"];t&&!(t!=null&&t.settings.trigger_on_file_creation)&&await t.templater.overwrite_file_commands(e)}var gr=class{constructor(e,t,i){this.owner=e,this.containerEl=t,t.on("click",".suggestion-item",this.onSuggestionClick.bind(this)),t.on("mousemove",".suggestion-item",this.onSuggestionMouseover.bind(this)),i.register([],"ArrowUp",o=>{if(!o.isComposing)return this.setSelectedItem(this.selectedItem-1,!0),!1}),i.register([],"ArrowDown",o=>{if(!o.isComposing)return this.setSelectedItem(this.selectedItem+1,!0),!1}),i.register([],"Enter",o=>{if(!o.isComposing)return this.useSelectedItem(o),!1})}onSuggestionClick(e,t){e.preventDefault();let i=this.suggestions.indexOf(t);this.setSelectedItem(i,!1),this.useSelectedItem(e)}onSuggestionMouseover(e,t){let i=this.suggestions.indexOf(t);this.setSelectedItem(i,!1)}setSuggestions(e){this.containerEl.empty();let t=[];e.forEach(i=>{let o=this.containerEl.createDiv("suggestion-item");this.owner.renderSuggestion(i,o),t.push(o)}),this.values=e,this.suggestions=t,this.setSelectedItem(0,!1)}useSelectedItem(e){let t=this.values[this.selectedItem];t&&this.owner.selectSuggestion(t,e)}setSelectedItem(e,t){let i=this.suggestions.length>0?oo(e,this.suggestions.length):0,o=this.suggestions[this.selectedItem],n=this.suggestions[i];o==null||o.removeClass("is-selected"),n==null||n.addClass("is-selected"),this.selectedItem=i,t&&n.scrollIntoView(!1)}},St=class{constructor(e,t){this.app=e,this.inputEl=t,this.scope=new co.Scope,this.suggestEl=createDiv("suggestion-container");let i=this.suggestEl.createDiv("suggestion");this.suggest=new gr(this,i,this.scope),this.scope.register([],"Escape",this.close.bind(this)),this.inputEl.addEventListener("input",this.onInputChanged.bind(this)),this.inputEl.addEventListener("focus",this.onInputChanged.bind(this)),this.inputEl.addEventListener("blur",this.close.bind(this)),this.suggestEl.on("mousedown",".suggestion-container",o=>{o.preventDefault()})}onInputChanged(){let e=this.inputEl.value,t=this.getSuggestions(e);t.length>0&&(this.suggest.setSuggestions(t),this.open(this.app.dom.appContainerEl,this.inputEl))}open(e,t){this.app.keymap.pushScope(this.scope),e.appendChild(this.suggestEl),this.popper=lr(t,this.suggestEl,{placement:"bottom-start",modifiers:[{name:"sameWidth",enabled:!0,fn:({state:i,instance:o})=>{let n=`${i.rects.reference.width}px`;i.styles.popper.width!==n&&(i.styles.popper.width=n,o.update())},phase:"beforeWrite",requires:["computeStyles"]}]})}close(){var e;this.app.keymap.popScope(this.scope),this.suggest.setSuggestions([]),(e=this.popper)==null||e.destroy(),this.suggestEl.detach()}};var Me=class extends St{getSuggestions(e){let t=this.app.vault.getAllLoadedFiles(),i=[],o=e.toLowerCase();return t.forEach(n=>{n instanceof uo.TFolder&&n.path.toLowerCase().contains(o)&&i.push(n)}),i}renderSuggestion(e,t){t.setText(e.path)}selectSuggestion(e){this.inputEl.value=e.path,this.inputEl.trigger("input"),this.close()}};var mo=require("obsidian"),ve=class extends St{getSuggestions(e){let t=this.app.vault.getAllLoadedFiles(),i=[],o=e.toLowerCase();return t.forEach(n=>{n instanceof mo.TFile&&n.name.toLowerCase().contains(o)&&i.push(n)}),i}renderSuggestion(e,t){t.setText(e.path)}selectSuggestion(e){this.inputEl.value=e.path,this.inputEl.trigger("input"),this.close()}};function ne(){}function yr(r){return r()}function fi(){return Object.create(null)}function Ce(r){r.forEach(yr)}function hi(r){return typeof r=="function"}function Dt(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}function fo(r){return Object.keys(r).length===0}var Mr=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var gi=class r{constructor(e){X(this,"_listeners","WeakMap"in Mr?new WeakMap:void 0);X(this,"_observer");X(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(t=>{var i;for(let o of t)r.entries.set(o.target,o),(i=this._listeners.get(o.target))==null||i(o)})}};gi.entries="WeakMap"in Mr?new WeakMap:void 0;var ho=!1;function go(){ho=!0}function yo(){ho=!1}function L(r,e){r.appendChild(e)}function Mo(r,e,t){let i=vo(r);if(!i.getElementById(e)){let o=A("style");o.id=e,o.textContent=t,Wn(i,o)}}function vo(r){if(!r)return document;let e=r.getRootNode?r.getRootNode():r.ownerDocument;return e&&e.host?e:r.ownerDocument}function Wn(r,e){return L(r.head||r,e),e.sheet}function Y(r,e,t){r.insertBefore(e,t||null)}function W(r){r.parentNode&&r.parentNode.removeChild(r)}function Kt(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function A(r){return document.createElement(r)}function ot(r){return document.createTextNode(r)}function Ue(){return ot(" ")}function yi(){return ot("")}function Xt(r,e,t,i){return r.addEventListener(e,t,i),()=>r.removeEventListener(e,t,i)}function O(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function bo(r){return Array.from(r.childNodes)}function Mi(r,e){e=""+e,r.data!==e&&(r.data=e)}function vi(r,e){r.value=e==null?"":e}function Jt(r,e,t,i){t==null?r.style.removeProperty(e):r.style.setProperty(e,t,i?"important":"")}function vr(r,e,t){for(let i=0;i<r.options.length;i+=1){let o=r.options[i];if(o.__value===e){o.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function wo(r){let e=r.querySelector(":checked");return e&&e.__value}function xo(r){let e={};return r.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}var He;function Ne(r){He=r}function _o(){if(!He)throw new Error("Function called outside component initialization");return He}function br(r){_o().$$.on_mount.push(r)}var nt=[];var bi=[],Ct=[],So=[],Gn=Promise.resolve(),xr=!1;function Do(){xr||(xr=!0,Gn.then(wi))}function at(r){Ct.push(r)}var wr=new Set,Et=0;function wi(){if(Et!==0)return;let r=He;do{try{for(;Et<nt.length;){let e=nt[Et];Et++,Ne(e),Yn(e.$$)}}catch(e){throw nt.length=0,Et=0,e}for(Ne(null),nt.length=0,Et=0;bi.length;)bi.pop()();for(let e=0;e<Ct.length;e+=1){let t=Ct[e];wr.has(t)||(wr.add(t),t())}Ct.length=0}while(nt.length);for(;So.length;)So.pop()();xr=!1,wr.clear(),Ne(r)}function Yn(r){if(r.fragment!==null){r.update(),Ce(r.before_update);let e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(at)}}function Eo(r){let e=[],t=[];Ct.forEach(i=>r.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),Ct=e}var xi=new Set,st;function lt(){st={r:0,c:[],p:st}}function pt(){st.r||Ce(st.c),st=st.p}function z(r,e){r&&r.i&&(xi.delete(r),r.i(e))}function se(r,e,t,i){if(r&&r.o){if(xi.has(r))return;xi.add(r),st.c.push(()=>{xi.delete(r),i&&(t&&r.d(1),i())}),r.o(e)}else i&&i()}function Be(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}var zn=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Kn=new Set([...zn]);function Ti(r){r&&r.c()}function Zt(r,e,t){let{fragment:i,after_update:o}=r.$$;i&&i.m(e,t),at(()=>{let n=r.$$.on_mount.map(yr).filter(hi);r.$$.on_destroy?r.$$.on_destroy.push(...n):Ce(n),r.$$.on_mount=[]}),o.forEach(at)}function Qt(r,e){let t=r.$$;t.fragment!==null&&(Eo(t.after_update),Ce(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Jn(r,e){r.$$.dirty[0]===-1&&(nt.push(r),Do(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Pt(r,e,t,i,o,n,a=null,s=[-1]){let l=He;Ne(r);let p=r.$$={fragment:null,ctx:[],props:n,update:ne,not_equal:o,bound:fi(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:fi(),dirty:s,skip_bound:!1,root:e.target||l.$$.root};a&&a(p.root);let d=!1;if(p.ctx=t?t(r,e.props||{},(c,f,...u)=>{let M=u.length?u[0]:f;return p.ctx&&o(p.ctx[c],p.ctx[c]=M)&&(!p.skip_bound&&p.bound[c]&&p.bound[c](M),d&&Jn(r,c)),f}):[],p.update(),d=!0,Ce(p.before_update),p.fragment=i?i(p.ctx):!1,e.target){if(e.hydrate){go();let c=bo(e.target);p.fragment&&p.fragment.l(c),c.forEach(W)}else p.fragment&&p.fragment.c();e.intro&&z(r.$$.fragment),Zt(r,e.target,e.anchor),yo(),wi()}Ne(l)}var Zn;typeof HTMLElement=="function"&&(Zn=class extends HTMLElement{constructor(e,t,i){super();X(this,"$$ctor");X(this,"$$s");X(this,"$$c");X(this,"$$cn",!1);X(this,"$$d",{});X(this,"$$r",!1);X(this,"$$p_d",{});X(this,"$$l",{});X(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,i&&this.attachShadow({mode:"open"})}addEventListener(e,t,i){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let o=this.$$c.$on(e,t);this.$$l_u.set(t,o)}super.addEventListener(e,t,i)}removeEventListener(e,t,i){if(super.removeEventListener(e,t,i),this.$$c){let o=this.$$l_u.get(t);o&&(o(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(n){return()=>{let a;return{c:function(){a=A("slot"),n!=="default"&&O(a,"name",n)},m:function(p,d){Y(p,a,d)},d:function(p){p&&W(a)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},i=xo(this);for(let n of this.$$s)n in i&&(t[n]=[e(n)]);for(let n of this.attributes){let a=this.$$g_p(n.name);a in this.$$d||(this.$$d[a]=Tr(a,n.value,this.$$p_d,"toProp"))}for(let n in this.$$p_d)!(n in this.$$d)&&this[n]!==void 0&&(this.$$d[n]=this[n],delete this[n]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let o=()=>{this.$$r=!0;for(let n in this.$$p_d)if(this.$$d[n]=this.$$c.$$.ctx[this.$$c.$$.props[n]],this.$$p_d[n].reflect){let a=Tr(n,this.$$d[n],this.$$p_d,"toAttribute");a==null?this.removeAttribute(this.$$p_d[n].attribute||n):this.setAttribute(this.$$p_d[n].attribute||n,a)}this.$$r=!1};this.$$c.$$.after_update.push(o),o();for(let n in this.$$l)for(let a of this.$$l[n]){let s=this.$$c.$on(n,a);this.$$l_u.set(a,s)}this.$$l={}}}attributeChangedCallback(e,t,i){var o;this.$$r||(e=this.$$g_p(e),this.$$d[e]=Tr(e,i,this.$$p_d,"toProp"),(o=this.$$c)==null||o.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{this.$$cn||(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function Tr(r,e,t,i){var n;let o=(n=t[r])==null?void 0:n.type;if(e=o==="Boolean"&&typeof e!="boolean"?e!=null:e,!i||!t[r])return e;if(i==="toAttribute")switch(o){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(o){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var Ie=class{constructor(){X(this,"$$");X(this,"$$set")}$destroy(){Qt(this,1),this.$destroy=ne}$on(e,t){if(!hi(t))return ne;let i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{let o=i.indexOf(t);o!==-1&&i.splice(o,1)}}$set(e){this.$$set&&!fo(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var Co="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Co);var Po=["default","remap","remove"],Ft=class r{constructor(e,t){this.type=e,this.properties=t!=null?t:[]}validate(){console.debug(`MDB | validated property mappings for ${this.type}`);for(let e of this.properties){let t=e.validate();if(!t.res)return{res:!1,err:t.err}}for(let e of this.getMappedProperties()){let t=this.getMappedProperties().filter(i=>i.newProperty===e.newProperty);if(t.length!==0){if(t.length!==1)return{res:!1,err:new Yt(`Multiple remapped properties (${t.map(i=>i.toString()).toString()}) may not share the same name.`)}}}for(let e of this.getMappedProperties())if(this.properties.filter(i=>i.newProperty===e.property).length!==0)return{res:!1,err:new Yt(`Remapped property (${e}) may not share it's new name with an existing property.`)};return{res:!0}}getMappedProperties(){return this.properties.filter(e=>e.mapping==="remap")}copy(){let e=new r(this.type);for(let t of this.properties){let i=new dt(t.property,t.newProperty,t.mapping,t.locked);e.properties.push(i)}return e}},dt=class{constructor(e,t,i,o){this.property=e,this.newProperty=t,this.mapping=i,this.locked=o!=null?o:!1}validate(){if(this.locked){if(this.mapping==="remove")return{res:!1,err:new rt(`Error in property mapping "${this.toString()}": locked property may not be removed.`)};if(this.mapping==="remap")return{res:!1,err:new rt(`Error in property mapping "${this.toString()}": locked property may not be remapped.`)}}return this.mapping==="default"?{res:!0}:this.mapping==="remove"?{res:!0}:!this.property||!ur(this.property)?{res:!1,err:new rt(`Error in property mapping "${this.toString()}": property may not be empty and only contain letters and underscores.`)}:!this.newProperty||!ur(this.newProperty)?{res:!1,err:new rt(`Error in property mapping "${this.toString()}": new property may not be empty and only contain letters and underscores.`)}:{res:!0}}toString(){return this.mapping==="default"?this.property:this.mapping==="remap"?`${this.property} -> ${this.newProperty}`:this.mapping==="remove"?`remove ${this.property}`:this.property}};var ko=require("obsidian");function Qn(r){Mo(r,"svelte-pwdquc",".icon-wrapper.svelte-pwdquc{display:inline-block;position:relative;width:20px}.icon.svelte-pwdquc{position:absolute;height:20px;width:20px;top:calc(50% - 10px)}")}function Fo(r){let e,t;return{c(){e=A("div"),t=A("div"),O(t,"class","icon svelte-pwdquc"),O(e,"class","icon-wrapper svelte-pwdquc")},m(i,o){Y(i,e,o),L(e,t),r[3](t)},p:ne,d(i){i&&W(e),r[3](null)}}}function ea(r){let e,t=r[0].length>0&&Fo(r);return{c(){t&&t.c(),e=yi()},m(i,o){t&&t.m(i,o),Y(i,e,o)},p(i,[o]){i[0].length>0?t?t.p(i,o):(t=Fo(i),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ne,o:ne,d(i){i&&W(e),t&&t.d(i)}}}function ta(r,e,t){let{iconName:i=""}=e,{iconSize:o=20}=e,n;br(()=>{(0,ko.setIcon)(n,i,o)});function a(s){bi[s?"unshift":"push"](()=>{n=s,t(1,n)})}return r.$$set=s=>{"iconName"in s&&t(0,i=s.iconName),"iconSize"in s&&t(2,o=s.iconSize)},[i,n,o,a]}var _r=class extends Ie{constructor(e){super(),Pt(this,e,ta,ea,Dt,{iconName:0,iconSize:2},Qn)}},$o=_r;function Ro(r,e,t){let i=r.slice();return i[7]=e[t],i[8]=e,i[9]=t,i}function ia(r,e,t){let i=r.slice();return i[10]=e[t],i}function ra(r){let e,t,i,o,n,a,s=Be(Po),l=[];for(let c=0;c<s.length;c+=1)l[c]=na(ia(r,s,c));function p(){r[3].call(e,r[8],r[9])}let d=r[7].mapping==="remap"&&Ao(r);return{c(){e=A("select");for(let c=0;c<l.length;c+=1)l[c].c();t=Ue(),d&&d.c(),i=yi(),O(e,"class","dropdown"),r[7].mapping===void 0&&at(p)},m(c,f){Y(c,e,f);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(e,null);vr(e,r[7].mapping,!0),Y(c,t,f),d&&d.m(c,f),Y(c,i,f),o=!0,n||(a=Xt(e,"change",p),n=!0)},p(c,f){r=c,f&1&&vr(e,r[7].mapping),r[7].mapping==="remap"?d?(d.p(r,f),f&1&&z(d,1)):(d=Ao(r),d.c(),z(d,1),d.m(i.parentNode,i)):d&&(lt(),se(d,1,1,()=>{d=null}),pt())},i(c){o||(z(d),o=!0)},o(c){se(d),o=!1},d(c){c&&(W(e),W(t),W(i)),Kt(l,c),d&&d.d(c),n=!1,a()}}}function oa(r){let e;return{c(){e=A("div"),e.textContent="property can not be remapped",O(e,"class","media-db-plugin-property-binding-text")},m(t,i){Y(t,e,i)},p:ne,i:ne,o:ne,d(t){t&&W(e)}}}function na(r){let e,t;return{c(){e=A("option"),e.textContent=`${r[10]} `,e.__value=t=r[10],vi(e,e.__value)},m(i,o){Y(i,e,o)},p:ne,d(i){i&&W(e)}}}function Ao(r){let e,t,i,o,n,a,s;e=new $o({props:{iconName:"arrow-right"}});function l(){r[4].call(o,r[8],r[9])}return{c(){Ti(e.$$.fragment),t=Ue(),i=A("div"),o=A("input"),O(o,"type","text"),O(o,"spellcheck","false"),O(i,"class","media-db-plugin-property-mapping-to")},m(p,d){Zt(e,p,d),Y(p,t,d),Y(p,i,d),L(i,o),vi(o,r[7].newProperty),n=!0,a||(s=Xt(o,"input",l),a=!0)},p(p,d){r=p,d&1&&o.value!==r[7].newProperty&&vi(o,r[7].newProperty)},i(p){n||(z(e.$$.fragment,p),n=!0)},o(p){se(e.$$.fragment,p),n=!1},d(p){p&&(W(t),W(i)),Qt(e,p),a=!1,s()}}}function Oo(r){let e,t,i,o,n=r[7].property+"",a,s,l,p,d,c,f=[oa,ra],u=[];function M(g,m){return g[7].locked?0:1}return l=M(r,-1),p=u[l]=f[l](r),{c(){e=A("div"),t=A("div"),i=A("pre"),o=A("code"),a=ot(n),s=Ue(),p.c(),d=Ue(),O(i,"class","media-db-plugin-property-mapping-element-property-name"),O(t,"class","media-db-plugin-property-mapping-element-property-name-wrapper"),O(e,"class","media-db-plugin-property-mapping-element")},m(g,m){Y(g,e,m),L(e,t),L(t,i),L(i,o),L(o,a),L(e,s),u[l].m(e,null),L(e,d),c=!0},p(g,m){(!c||m&1)&&n!==(n=g[7].property+"")&&Mi(a,n);let _=l;l=M(g,m),l===_?u[l].p(g,m):(lt(),se(u[_],1,1,()=>{u[_]=null}),pt(),p=u[l],p?p.p(g,m):(p=u[l]=f[l](g),p.c()),z(p,1),p.m(e,d))},i(g){c||(z(p),c=!0)},o(g){se(p),c=!1},d(g){g&&W(e),u[l].d()}}}function No(r){var o,n;let e,t=((n=(o=r[2])==null?void 0:o.err)==null?void 0:n.message)+"",i;return{c(){e=A("div"),i=ot(t),O(e,"class","media-db-plugin-property-mapping-validation")},m(a,s){Y(a,e,s),L(e,i)},p(a,s){var l,p;s&4&&t!==(t=((p=(l=a[2])==null?void 0:l.err)==null?void 0:p.message)+"")&&Mi(i,t)},d(a){a&&W(e)}}}function aa(r){var D;let e,t,i=fr(r[0].type)+"",o,n,a,s,l,p,d,c,f,u,M,g=Be(r[0].properties),m=[];for(let h=0;h<g.length;h+=1)m[h]=Oo(Ro(r,g,h));let _=h=>se(m[h],1,1,()=>{m[h]=null}),b=!((D=r[2])!=null&&D.res)&&No(r);return{c(){var h;e=A("div"),t=A("div"),o=ot(i),n=Ue(),a=A("div");for(let y=0;y<m.length;y+=1)m[y].c();s=Ue(),b&&b.c(),l=Ue(),p=A("button"),d=ot("Save"),O(t,"class","setting-item-name"),O(a,"class","media-db-plugin-property-mappings-container"),O(p,"class",c="media-db-plugin-property-mappings-save-button "+((h=r[2])!=null&&h.res?"mod-cta":"mod-muted")),O(e,"class","media-db-plugin-property-mappings-model-container")},m(h,y){Y(h,e,y),L(e,t),L(t,o),L(e,n),L(e,a);for(let w=0;w<m.length;w+=1)m[w]&&m[w].m(a,null);L(e,s),b&&b.m(e,null),L(e,l),L(e,p),L(p,d),f=!0,u||(M=Xt(p,"click",r[5]),u=!0)},p(h,[y]){var w,S;if((!f||y&1)&&i!==(i=fr(h[0].type)+"")&&Mi(o,i),y&1){g=Be(h[0].properties);let T;for(T=0;T<g.length;T+=1){let E=Ro(h,g,T);m[T]?(m[T].p(E,y),z(m[T],1)):(m[T]=Oo(E),m[T].c(),z(m[T],1),m[T].m(a,null))}for(lt(),T=g.length;T<m.length;T+=1)_(T);pt()}(w=h[2])!=null&&w.res?b&&(b.d(1),b=null):b?b.p(h,y):(b=No(h),b.c(),b.m(e,l)),(!f||y&4&&c!==(c="media-db-plugin-property-mappings-save-button "+((S=h[2])!=null&&S.res?"mod-cta":"mod-muted")))&&O(p,"class",c)},i(h){if(!f){for(let y=0;y<g.length;y+=1)z(m[y]);f=!0}},o(h){m=m.filter(Boolean);for(let y=0;y<m.length;y+=1)se(m[y]);f=!1},d(h){h&&W(e),Kt(m,h),b&&b.d(),u=!1,M()}}}function sa(r,e,t){let{model:i}=e,{save:o}=e,n;function a(d){t(2,n=d.validate())}function s(d,c){d[c].mapping=wo(this),t(0,i)}function l(d,c){d[c].newProperty=this.value,t(0,i)}let p=()=>{i.validate().res&&o(i)};return r.$$set=d=>{"model"in d&&t(0,i=d.model),"save"in d&&t(1,o=d.save)},r.$$.update=()=>{r.$$.dirty&1&&a(i)},[i,o,n,s,l,p]}var Sr=class extends Ie{constructor(e){super(),Pt(this,e,sa,aa,Dt,{model:0,save:1})}},Io=Sr;function Lo(r,e,t){let i=r.slice();return i[2]=e[t],i}function Wo(r){let e,t;return e=new Io({props:{model:r[2],save:r[1]}}),{c(){Ti(e.$$.fragment)},m(i,o){Zt(e,i,o),t=!0},p(i,o){let n={};o&1&&(n.model=i[2]),o&2&&(n.save=i[1]),e.$set(n)},i(i){t||(z(e.$$.fragment,i),t=!0)},o(i){se(e.$$.fragment,i),t=!1},d(i){Qt(e,i)}}}function la(r){let e,t,i=Be(r[0]),o=[];for(let a=0;a<i.length;a+=1)o[a]=Wo(Lo(r,i,a));let n=a=>se(o[a],1,1,()=>{o[a]=null});return{c(){e=A("div");for(let a=0;a<o.length;a+=1)o[a].c();O(e,"class","setting-item"),Jt(e,"display","flex"),Jt(e,"gap","10px"),Jt(e,"flex-direction","column"),Jt(e,"align-items","stretch")},m(a,s){Y(a,e,s);for(let l=0;l<o.length;l+=1)o[l]&&o[l].m(e,null);t=!0},p(a,[s]){if(s&3){i=Be(a[0]);let l;for(l=0;l<i.length;l+=1){let p=Lo(a,i,l);o[l]?(o[l].p(p,s),z(o[l],1)):(o[l]=Wo(p),o[l].c(),z(o[l],1),o[l].m(e,null))}for(lt(),l=i.length;l<o.length;l+=1)n(l);pt()}},i(a){if(!t){for(let s=0;s<i.length;s+=1)z(o[s]);t=!0}},o(a){o=o.filter(Boolean);for(let s=0;s<o.length;s+=1)se(o[s]);t=!1},d(a){a&&W(e),Kt(o,a)}}}function pa(r,e,t){let{models:i=[]}=e,{save:o}=e;return r.$$set=n=>{"models"in n&&t(0,i=n.models),"save"in n&&t(1,o=n.save)},[i,o]}var Dr=class extends Ie{constructor(e){super(),Pt(this,e,pa,la,Dt,{models:0,save:1})}},jo=Dr;var Er=require("obsidian");var Q=class{constructor(){this.type=void 0,this.subType=void 0,this.title=void 0,this.englishTitle=void 0,this.year=void 0,this.dataSource=void 0,this.url=void 0,this.id=void 0,this.userData={}}toMetaDataObject(){return{...this.getWithOutUserData(),...this.userData,tags:this.getTags().join("/")}}getWithOutUserData(){let e=structuredClone(this);return delete e.userData,e}};var me=class extends Q{constructor(e={}){super(),this.plot=void 0,this.genres=void 0,this.director=void 0,this.writer=void 0,this.studio=void 0,this.duration=void 0,this.onlineRating=void 0,this.actors=void 0,this.image=void 0,this.released=void 0,this.streamingServices=void 0,this.premiere=void 0,this.userData={watched:void 0,lastWatched:void 0,personalRating:void 0},$(this,e,this),e.hasOwnProperty("userData")||$(this.userData,e,this.userData),this.type=this.getMediaType()}getTags(){return[oe,"tv","movie"]}getMediaType(){return"movie"}getSummary(){return this.englishTitle+" ("+this.year+")"}};var Pe=class extends Q{constructor(e={}){super(),this.plot=void 0,this.genres=void 0,this.writer=void 0,this.studio=void 0,this.episodes=void 0,this.duration=void 0,this.onlineRating=void 0,this.actors=void 0,this.image=void 0,this.released=void 0,this.streamingServices=void 0,this.airing=void 0,this.airedFrom=void 0,this.airedTo=void 0,this.userData={watched:void 0,lastWatched:void 0,personalRating:void 0},$(this,e,this),e.hasOwnProperty("userData")||$(this.userData,e,this.userData),this.type=this.getMediaType()}getTags(){return[oe,"tv","series"]}getMediaType(){return"series"}getSummary(){return this.title+" ("+this.year+")"}};var ct=class extends Q{constructor(e={}){super(),this.plot=void 0,this.genres=void 0,this.authors=void 0,this.alternateTitles=void 0,this.chapters=void 0,this.volumes=void 0,this.onlineRating=void 0,this.image=void 0,this.released=void 0,this.status=void 0,this.publishedFrom=void 0,this.publishedTo=void 0,this.userData={watched:void 0,lastWatched:void 0,personalRating:void 0},$(this,e,this),e.hasOwnProperty("userData")||$(this.userData,e,this.userData),this.type=this.getMediaType()}getTags(){return[oe,"manga","light-novel"]}getMediaType(){return"manga"}getSummary(){return this.title+" ("+this.year+")"}};var pe=class extends Q{constructor(e={}){super(),this.developers=void 0,this.publishers=void 0,this.genres=void 0,this.onlineRating=void 0,this.image=void 0,this.released=void 0,this.releaseDate=void 0,this.userData={played:void 0,personalRating:void 0},$(this,e,this),e.hasOwnProperty("userData")||$(this.userData,e,this.userData),this.type=this.getMediaType()}getTags(){return[oe,"game"]}getMediaType(){return"game"}getSummary(){return this.englishTitle+" ("+this.year+")"}};var ut=class extends Q{constructor(e={}){super(),this.wikiUrl=void 0,this.lastUpdated=void 0,this.length=void 0,this.article=void 0,this.userData={},$(this,e,this),e.hasOwnProperty("userData")||$(this.userData,e,this.userData),this.type=this.getMediaType()}getTags(){return[oe,"wiki"]}getMediaType(){return"wiki"}getWithOutUserData(){let e=structuredClone(this);return delete e.userData,delete e.article,e}getSummary(){return this.title}};var mt=class extends Q{constructor(e={}){super(),this.genres=void 0,this.artists=void 0,this.image=void 0,this.rating=void 0,this.userData={personalRating:void 0},$(this,e,this),e.hasOwnProperty("userData")||$(this.userData,e,this.userData),this.type=this.getMediaType()}getTags(){return[oe,"music",this.subType]}getMediaType(){return"musicRelease"}getSummary(){let e=this.title+" ("+this.year+")";return this.artists.length>0&&(e+=" - "+this.artists.join(", ")),e}};var ft=class extends Q{constructor(e={}){super(),this.genres=void 0,this.onlineRating=void 0,this.minPlayers=void 0,this.maxPlayers=void 0,this.playtime=void 0,this.publishers=void 0,this.complexityRating=void 0,this.image=void 0,this.released=void 0,this.userData={played:void 0,personalRating:void 0},$(this,e,this),e.hasOwnProperty("userData")||$(this.userData,e,this.userData),this.type=this.getMediaType()}getTags(){return[oe,"boardgame"]}getMediaType(){return"boardgame"}getSummary(){return this.englishTitle+" ("+this.year+")"}};var ht=class extends Q{constructor(e={}){super(),this.author=void 0,this.pages=void 0,this.image=void 0,this.onlineRating=void 0,this.isbn=void 0,this.isbn13=void 0,this.released=void 0,this.userData={read:void 0,lastRead:void 0,personalRating:void 0},$(this,e,this),e.hasOwnProperty("userData")||$(this.userData,e,this.userData),this.type=this.getMediaType()}getTags(){return[oe,"book"]}getMediaType(){return"book"}getSummary(){return this.englishTitle+" ("+this.year+") - "+this.author}};var Fe=["movie","series","manga","game","wiki","musicRelease","boardgame","book"],_i=class{constructor(){}updateTemplates(e){this.mediaFileNameTemplateMap=new Map,this.mediaFileNameTemplateMap.set("movie",e.movieFileNameTemplate),this.mediaFileNameTemplateMap.set("series",e.seriesFileNameTemplate),this.mediaFileNameTemplateMap.set("manga",e.mangaFileNameTemplate),this.mediaFileNameTemplateMap.set("game",e.gameFileNameTemplate),this.mediaFileNameTemplateMap.set("wiki",e.wikiFileNameTemplate),this.mediaFileNameTemplateMap.set("musicRelease",e.musicReleaseFileNameTemplate),this.mediaFileNameTemplateMap.set("boardgame",e.boardgameFileNameTemplate),this.mediaFileNameTemplateMap.set("book",e.bookFileNameTemplate),this.mediaTemplateMap=new Map,this.mediaTemplateMap.set("movie",e.movieTemplate),this.mediaTemplateMap.set("series",e.seriesTemplate),this.mediaTemplateMap.set("manga",e.mangaTemplate),this.mediaTemplateMap.set("game",e.gameTemplate),this.mediaTemplateMap.set("wiki",e.wikiTemplate),this.mediaTemplateMap.set("musicRelease",e.musicReleaseTemplate),this.mediaTemplateMap.set("boardgame",e.boardgameTemplate),this.mediaTemplateMap.set("book",e.bookTemplate)}updateFolders(e){this.mediaFolderMap=new Map,this.mediaFolderMap.set("movie",e.movieFolder),this.mediaFolderMap.set("series",e.seriesFolder),this.mediaFolderMap.set("manga",e.mangaFolder),this.mediaFolderMap.set("game",e.gameFolder),this.mediaFolderMap.set("wiki",e.wikiFolder),this.mediaFolderMap.set("musicRelease",e.musicReleaseFolder),this.mediaFolderMap.set("boardgame",e.boardgameFolder),this.mediaFolderMap.set("book",e.bookFolder)}getFileName(e){return mr(this.mediaFileNameTemplateMap.get(e.getMediaType()),e,!0)}async getTemplate(e,t){let i=this.mediaTemplateMap.get(e.getMediaType());if(!i)return"";let o=t.vault.getAbstractFileByPath(i);if((!o||o instanceof Er.TFolder)&&(o=t.vault.getFiles().filter(a=>a.name===i).first(),!o))return"";let n=await t.vault.cachedRead(o);return mr(n,e)}async getFolder(e,t){let i=this.mediaFolderMap.get(e.getMediaType());i||(i="/"),await t.vault.adapter.exists(i)||await t.vault.createFolder(i);let o=t.vault.getAbstractFileByPath(i);if(!(o instanceof Er.TFolder))throw Error(`Expected ${o} to be instance of TFolder`);return o}createMediaTypeModelFromMediaType(e,t){if(t==="movie")return new me(e);if(t==="series")return new Pe(e);if(t==="manga")return new ct(e);if(t==="game")return new pe(e);if(t==="wiki")return new ut(e);if(t==="musicRelease")return new mt(e);if(t==="boardgame")return new ft(e);if(t==="book")return new ht(e)}};var q={OMDbKey:"",MobyGamesKey:"",sfwFilter:!0,templates:!0,customDateFormat:"L",openNoteInNewTab:!0,useDefaultFrontMatter:!0,enableTemplaterIntegration:!1,movieTemplate:"",seriesTemplate:"",mangaTemplate:"",gameTemplate:"",wikiTemplate:"",musicReleaseTemplate:"",boardgameTemplate:"",bookTemplate:"",movieFileNameTemplate:"{{ title }} ({{ year }})",seriesFileNameTemplate:"{{ title }} ({{ year }})",mangaFileNameTemplate:"{{ title }} ({{ year }})",gameFileNameTemplate:"{{ title }} ({{ year }})",wikiFileNameTemplate:"{{ title }}",musicReleaseFileNameTemplate:"{{ title }} (by {{ ENUM:artists }} - {{ year }})",boardgameFileNameTemplate:"{{ title }} ({{ year }})",bookFileNameTemplate:"{{ title }} ({{ year }})",moviePropertyConversionRules:"",seriesPropertyConversionRules:"",mangaPropertyConversionRules:"",gamePropertyConversionRules:"",wikiPropertyConversionRules:"",musicReleasePropertyConversionRules:"",boardgamePropertyConversionRules:"",bookPropertyConversionRules:"",movieFolder:"Media DB/movies",seriesFolder:"Media DB/series",mangaFolder:"Media DB/manga",gameFolder:"Media DB/games",wikiFolder:"Media DB/wiki",musicReleaseFolder:"Media DB/music",boardgameFolder:"Media DB/boardgames",bookFolder:"Media DB/books",propertyMappingModels:[]},da=["type","id","dataSource"];function qo(r){let e=q,t=[];for(let i of Fe){let n=r.mediaTypeManager.createMediaTypeModelFromMediaType({},i).toMetaDataObject(),a=new Ft(i);for(let s of Object.keys(n))a.properties.push(new dt(s,"","default",da.contains(s)));t.push(a)}return e.propertyMappingModels=t,e}var Si=class extends C.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;if(e.empty(),e.createEl("h2",{text:"Media DB Plugin Settings"}),new C.Setting(e).setName("OMDb API key").setDesc('API key for "www.omdbapi.com".').addText(t=>{t.setPlaceholder("API key").setValue(this.plugin.settings.OMDbKey).onChange(i=>{this.plugin.settings.OMDbKey=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Moby Games key").setDesc('API key for "www.mobygames.com".').addText(t=>{t.setPlaceholder("API key").setValue(this.plugin.settings.MobyGamesKey).onChange(i=>{this.plugin.settings.MobyGamesKey=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("SFW filter").setDesc("Only shows SFW results for APIs that offer filtering.").addToggle(t=>{t.setValue(this.plugin.settings.sfwFilter).onChange(i=>{this.plugin.settings.sfwFilter=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Resolve {{ tags }} in templates").setDesc("Whether to resolve {{ tags }} in templates. The spaces inside the curly braces are important.").addToggle(t=>{t.setValue(this.plugin.settings.templates).onChange(i=>{this.plugin.settings.templates=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Date format").setDesc(so("Your custom date format. Use <em>'YYYY-MM-DD'</em> for example.<br>For more syntax, refer to <a href='https://momentjs.com/docs/#/displaying/format/'>format reference</a>.<br>Your current syntax looks like this: <b><a id='media-db-dateformat-preview' style='pointer-events: none; cursor: default; text-decoration: none;'>"+this.plugin.dateFormatter.getPreview()+"</a></b>")).addText(t=>{t.setPlaceholder(q.customDateFormat).setValue(this.plugin.settings.customDateFormat===q.customDateFormat?"":this.plugin.settings.customDateFormat).onChange(i=>{let o=i||q.customDateFormat;this.plugin.settings.customDateFormat=o,document.getElementById("media-db-dateformat-preview").textContent=this.plugin.dateFormatter.getPreview(o),this.plugin.saveSettings()})}),new C.Setting(e).setName("Open note in new tab").setDesc("Open the newly created note in a new tab.").addToggle(t=>{t.setValue(this.plugin.settings.openNoteInNewTab).onChange(i=>{this.plugin.settings.openNoteInNewTab=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Use default front matter").setDesc("Whether to use the default front matter. If disabled, the front matter from the template will be used. Same as mapping everything to remove.").addToggle(t=>{t.setValue(this.plugin.settings.useDefaultFrontMatter).onChange(i=>{this.plugin.settings.useDefaultFrontMatter=i,this.plugin.saveSettings(),this.display()})}),new C.Setting(e).setName("Enable Templater integration").setDesc("Enable integration with the templater plugin, this also needs templater to be installed. Warning: Templater allows you to execute arbitrary JavaScript code and system commands.").addToggle(t=>{t.setValue(this.plugin.settings.enableTemplaterIntegration).onChange(i=>{this.plugin.settings.enableTemplaterIntegration=i,this.plugin.saveSettings()})}),e.createEl("h3",{text:"New File Location"}),new C.Setting(e).setName("Movie Folder").setDesc("Where newly imported movies should be placed.").addSearch(t=>{new Me(this.app,t.inputEl),t.setPlaceholder(q.movieFolder).setValue(this.plugin.settings.movieFolder).onChange(i=>{this.plugin.settings.movieFolder=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Series Folder").setDesc("Where newly imported series should be placed.").addSearch(t=>{new Me(this.app,t.inputEl),t.setPlaceholder(q.seriesFolder).setValue(this.plugin.settings.seriesFolder).onChange(i=>{this.plugin.settings.seriesFolder=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Manga Folder").setDesc("Where newly imported manga should be placed.").addSearch(t=>{new Me(this.app,t.inputEl),t.setPlaceholder(q.mangaFolder).setValue(this.plugin.settings.mangaFolder).onChange(i=>{this.plugin.settings.mangaFolder=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Game Folder").setDesc("Where newly imported games should be placed.").addSearch(t=>{new Me(this.app,t.inputEl),t.setPlaceholder(q.gameFolder).setValue(this.plugin.settings.gameFolder).onChange(i=>{this.plugin.settings.gameFolder=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Wiki Folder").setDesc("Where newly imported wiki articles should be placed.").addSearch(t=>{new Me(this.app,t.inputEl),t.setPlaceholder(q.wikiFolder).setValue(this.plugin.settings.wikiFolder).onChange(i=>{this.plugin.settings.wikiFolder=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Music Folder").setDesc("Where newly imported music should be placed.").addSearch(t=>{new Me(this.app,t.inputEl),t.setPlaceholder(q.musicReleaseFolder).setValue(this.plugin.settings.musicReleaseFolder).onChange(i=>{this.plugin.settings.musicReleaseFolder=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Board Game Folder").setDesc("Where newly imported board games should be places.").addSearch(t=>{new Me(this.app,t.inputEl),t.setPlaceholder(q.boardgameFolder).setValue(this.plugin.settings.boardgameFolder).onChange(i=>{this.plugin.settings.boardgameFolder=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Book Folder").setDesc("Where newly imported books should be placed.").addSearch(t=>{new Me(this.app,t.inputEl),t.setPlaceholder(q.bookFolder).setValue(this.plugin.settings.bookFolder).onChange(i=>{this.plugin.settings.bookFolder=i,this.plugin.saveSettings()})}),e.createEl("h3",{text:"Template Settings"}),new C.Setting(e).setName("Movie template").setDesc("Template file to be used when creating a new note for a movie.").addSearch(t=>{new ve(this.app,t.inputEl),t.setPlaceholder("Example: movieTemplate.md").setValue(this.plugin.settings.movieTemplate).onChange(i=>{this.plugin.settings.movieTemplate=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Series template").setDesc("Template file to be used when creating a new note for a series.").addSearch(t=>{new ve(this.app,t.inputEl),t.setPlaceholder("Example: seriesTemplate.md").setValue(this.plugin.settings.seriesTemplate).onChange(i=>{this.plugin.settings.seriesTemplate=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Manga template").setDesc("Template file to be used when creating a new note for a manga.").addSearch(t=>{new ve(this.app,t.inputEl),t.setPlaceholder("Example: mangaTemplate.md").setValue(this.plugin.settings.mangaTemplate).onChange(i=>{this.plugin.settings.mangaTemplate=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Game template").setDesc("Template file to be used when creating a new note for a game.").addSearch(t=>{new ve(this.app,t.inputEl),t.setPlaceholder("Example: gameTemplate.md").setValue(this.plugin.settings.gameTemplate).onChange(i=>{this.plugin.settings.gameTemplate=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Wiki template").setDesc("Template file to be used when creating a new note for a wiki entry.").addSearch(t=>{new ve(this.app,t.inputEl),t.setPlaceholder("Example: wikiTemplate.md").setValue(this.plugin.settings.wikiTemplate).onChange(i=>{this.plugin.settings.wikiTemplate=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Music Release template").setDesc("Template file to be used when creating a new note for a music release.").addSearch(t=>{new ve(this.app,t.inputEl),t.setPlaceholder("Example: musicReleaseTemplate.md").setValue(this.plugin.settings.musicReleaseTemplate).onChange(i=>{this.plugin.settings.musicReleaseTemplate=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Board Game template").setDesc("Template file to be used when creating a new note for a boardgame.").addSearch(t=>{new ve(this.app,t.inputEl),t.setPlaceholder("Example: boardgameTemplate.md").setValue(this.plugin.settings.boardgameTemplate).onChange(i=>{this.plugin.settings.boardgameTemplate=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Book template").setDesc("Template file to be used when creating a new note for a book.").addSearch(t=>{new ve(this.app,t.inputEl),t.setPlaceholder("Example: bookTemplate.md").setValue(this.plugin.settings.bookTemplate).onChange(i=>{this.plugin.settings.bookTemplate=i,this.plugin.saveSettings()})}),e.createEl("h3",{text:"File Name Settings"}),new C.Setting(e).setName("Movie file name template").setDesc("Template for the file name used when creating a new note for a movie.").addText(t=>{t.setPlaceholder(`Example: ${q.movieFileNameTemplate}`).setValue(this.plugin.settings.movieFileNameTemplate).onChange(i=>{this.plugin.settings.movieFileNameTemplate=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Series file name template").setDesc("Template for the file name used when creating a new note for a series.").addText(t=>{t.setPlaceholder(`Example: ${q.seriesFileNameTemplate}`).setValue(this.plugin.settings.seriesFileNameTemplate).onChange(i=>{this.plugin.settings.seriesFileNameTemplate=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Manga file name template").setDesc("Template for the file name used when creating a new note for a manga.").addText(t=>{t.setPlaceholder(`Example: ${q.mangaFileNameTemplate}`).setValue(this.plugin.settings.mangaFileNameTemplate).onChange(i=>{this.plugin.settings.mangaFileNameTemplate=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Game file name template").setDesc("Template for the file name used when creating a new note for a game.").addText(t=>{t.setPlaceholder(`Example: ${q.gameFileNameTemplate}`).setValue(this.plugin.settings.gameFileNameTemplate).onChange(i=>{this.plugin.settings.gameFileNameTemplate=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Wiki file name template").setDesc("Template for the file name used when creating a new note for a wiki entry.").addText(t=>{t.setPlaceholder(`Example: ${q.wikiFileNameTemplate}`).setValue(this.plugin.settings.wikiFileNameTemplate).onChange(i=>{this.plugin.settings.wikiFileNameTemplate=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Music Release file name template").setDesc("Template for the file name used when creating a new note for a music release.").addText(t=>{t.setPlaceholder(`Example: ${q.musicReleaseFileNameTemplate}`).setValue(this.plugin.settings.musicReleaseFileNameTemplate).onChange(i=>{this.plugin.settings.musicReleaseFileNameTemplate=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Board Game file name template").setDesc("Template for the file name used when creating a new note for a boardgame.").addText(t=>{t.setPlaceholder(`Example: ${q.boardgameFileNameTemplate}`).setValue(this.plugin.settings.boardgameFileNameTemplate).onChange(i=>{this.plugin.settings.boardgameFileNameTemplate=i,this.plugin.saveSettings()})}),new C.Setting(e).setName("Book file name template").setDesc("Template for the file name used when creating a new note for a book.").addText(t=>{t.setPlaceholder(`Example: ${q.bookFileNameTemplate}`).setValue(this.plugin.settings.bookFileNameTemplate).onChange(i=>{this.plugin.settings.bookFileNameTemplate=i,this.plugin.saveSettings()})}),this.plugin.settings.useDefaultFrontMatter){e.createEl("h3",{text:"Property Mappings"});let t=e.createEl("div");t.innerHTML=`
		<p>Allow you to remap the metadata fields of newly created media db entries.</p>
		<p>
			The different options are:
			<lu>
				<li>"default": does no remapping and keeps the metadata field as it is</li>
				<li>"remap": renames the metadata field to what ever you specify</li>
				<li>"remove": removes the metadata field entirely</li>
			</lu>
		</p>
		<p>
			Don't forget to save your changes using the save button for each individual category.
		</p>`,new jo({target:this.containerEl,props:{models:this.plugin.settings.propertyMappingModels.map(i=>i.copy()),save:i=>{let o=[];for(let n of this.plugin.settings.propertyMappingModels)n.type===i.type?o.push(i):o.push(n);this.plugin.settings.propertyMappingModels=o,new C.Notice(`MDB: Property Mappings for ${i.type} saved successfully.`),this.plugin.saveSettings()}}})}}};var Di=class{constructor(){this.apis=[]}async query(e,t){console.debug(`MDB | api manager queried with "${e}"`);let i=[];for(let o of this.apis)if(t.contains(o.apiName))try{let n=await o.searchByTitle(e);i=i.concat(n)}catch(n){console.warn(n)}return i}async queryDetailedInfo(e){return await this.queryDetailedInfoById(e.id,e.dataSource)}async queryDetailedInfoById(e,t){for(let i of this.apis)if(i.apiName===t)return i.getById(e)}getApiByName(e){for(let t of this.apis)if(t.apiName===e)return t;return null}registerAPI(e){this.apis.push(e)}};var U=class{hasType(e){return!0}hasTypeOverlap(e){for(let t of e)if(this.hasType(t))return!0;return!1}};var Ei=class extends U{constructor(t){super();this.apiDateFormat="DD MMM YYYY";this.plugin=t,this.apiName="OMDbAPI",this.apiDescription="A free API for Movies, Series and Games.",this.apiUrl="http://www.omdbapi.com/",this.types=["movie","series","game"],this.typeMappings=new Map,this.typeMappings.set("movie","movie"),this.typeMappings.set("series","series"),this.typeMappings.set("game","game")}async searchByTitle(t){console.log(`MDB | api "${this.apiName}" queried by Title`);let i=`http://www.omdbapi.com/?s=${encodeURIComponent(t)}&apikey=${this.plugin.settings.OMDbKey}`,o=await fetch(i);if(o.status===401)throw Error(`MDB | Authentication for ${this.apiName} failed. Check the API key.`);if(o.status!==200)throw Error(`MDB | Received status code ${o.status} from an API.`);let n=await o.json();if(n.Response==="False"){if(n.Error==="Movie not found!")return[];throw Error(`MDB | Received error from ${this.apiName}: 
${JSON.stringify(n,void 0,4)}`)}if(!n.Search)return[];console.debug(n.Search);let a=[];for(let s of n.Search){let l=this.typeMappings.get(s.Type.toLowerCase());l!==void 0&&(l==="movie"?a.push(new me({type:l,title:s.Title,englishTitle:s.Title,year:s.Year,dataSource:this.apiName,id:s.imdbID})):l==="series"?a.push(new Pe({type:l,title:s.Title,englishTitle:s.Title,year:s.Year,dataSource:this.apiName,id:s.imdbID})):l==="game"&&a.push(new pe({type:l,title:s.Title,englishTitle:s.Title,year:s.Year,dataSource:this.apiName,id:s.imdbID})))}return a}async getById(t){var s,l,p,d,c,f,u,M,g,m,_,b,D,h,y,w,S,T,E,x,v,F,P,H,N,R,ee,_e,le;console.log(`MDB | api "${this.apiName}" queried by ID`);let i=`http://www.omdbapi.com/?i=${encodeURIComponent(t)}&apikey=${this.plugin.settings.OMDbKey}`,o=await fetch(i);if(o.status===401)throw Error(`MDB | Authentication for ${this.apiName} failed. Check the API key.`);if(o.status!==200)throw Error(`MDB | Received status code ${o.status} from an API.`);let n=await o.json();if(n.Response==="False")throw Error(`MDB | Received error from ${this.apiName}: ${n.Error}`);let a=this.typeMappings.get(n.Type.toLowerCase());if(a===void 0)throw Error(`${n.type.toLowerCase()} is an unsupported type.`);if(a==="movie")return new me({type:a,title:n.Title,englishTitle:n.Title,year:n.Year,dataSource:this.apiName,url:`https://www.imdb.com/title/${n.imdbID}/`,id:n.imdbID,plot:(s=n.Plot)!=null?s:"",genres:(p=(l=n.Genre)==null?void 0:l.split(", "))!=null?p:[],director:(c=(d=n.Director)==null?void 0:d.split(", "))!=null?c:[],writer:(u=(f=n.Writer)==null?void 0:f.split(", "))!=null?u:[],studio:["N/A"],duration:(M=n.Runtime)!=null?M:"unknown",onlineRating:Number.parseFloat((g=n.imdbRating)!=null?g:0),actors:(_=(m=n.Actors)==null?void 0:m.split(", "))!=null?_:[],image:(b=n.Poster)!=null?b:"",released:!0,streamingServices:[],premiere:(D=this.plugin.dateFormatter.format(n.Released,this.apiDateFormat))!=null?D:"unknown",userData:{watched:!1,lastWatched:"",personalRating:0}});if(a==="series")return new Pe({type:a,title:n.Title,englishTitle:n.Title,year:n.Year,dataSource:this.apiName,url:`https://www.imdb.com/title/${n.imdbID}/`,id:n.imdbID,plot:(h=n.Plot)!=null?h:"",genres:(w=(y=n.Genre)==null?void 0:y.split(", "))!=null?w:[],writer:(T=(S=n.Writer)==null?void 0:S.split(", "))!=null?T:[],studio:[],episodes:0,duration:(E=n.Runtime)!=null?E:"unknown",onlineRating:Number.parseFloat((x=n.imdbRating)!=null?x:0),actors:(F=(v=n.Actors)==null?void 0:v.split(", "))!=null?F:[],image:(P=n.Poster)!=null?P:"",released:!0,streamingServices:[],airing:!1,airedFrom:(H=this.plugin.dateFormatter.format(n.Released,this.apiDateFormat))!=null?H:"unknown",airedTo:"unknown",userData:{watched:!1,lastWatched:"",personalRating:0}});if(a==="game")return new pe({type:a,title:n.Title,englishTitle:n.Title,year:n.Year,dataSource:this.apiName,url:`https://www.imdb.com/title/${n.imdbID}/`,id:n.imdbID,developers:[],publishers:[],genres:(R=(N=n.Genre)==null?void 0:N.split(", "))!=null?R:[],onlineRating:Number.parseFloat((ee=n.imdbRating)!=null?ee:0),image:(_e=n.Poster)!=null?_e:"",released:!0,releaseDate:(le=this.plugin.dateFormatter.format(n.Released,this.apiDateFormat))!=null?le:"unknown",userData:{played:!1,personalRating:0}})}};var Ci=class extends U{constructor(t){super();this.apiDateFormat="YYYY-MM-DDTHH:mm:ssZ";this.plugin=t,this.apiName="MALAPI",this.apiDescription="A free API for Anime. Some results may take a long time to load.",this.apiUrl="https://jikan.moe/",this.types=["movie","series"],this.typeMappings=new Map,this.typeMappings.set("movie","movie"),this.typeMappings.set("special","special"),this.typeMappings.set("tv","series"),this.typeMappings.set("ova","ova")}async searchByTitle(t){var s,l,p,d,c,f,u,M,g,m,_,b,D,h,y,w,S,T,E;console.log(`MDB | api "${this.apiName}" queried by Title`);let i=`https://api.jikan.moe/v4/anime?q=${encodeURIComponent(t)}&limit=20${this.plugin.settings.sfwFilter?"&sfw":""}`,o=await fetch(i);if(console.debug(o),o.status!==200)throw Error(`MDB | Received status code ${o.status} from an API.`);let n=await o.json();console.debug(n);let a=[];for(let x of n.data){let v=this.typeMappings.get((s=x.type)==null?void 0:s.toLowerCase());v===void 0&&a.push(new me({subType:"",title:x.title,englishTitle:(l=x.title_english)!=null?l:x.title,year:(u=(f=x.year)!=null?f:(c=(d=(p=x.aired)==null?void 0:p.prop)==null?void 0:d.from)==null?void 0:c.year)!=null?u:"",dataSource:this.apiName,id:x.mal_id})),v==="movie"||v==="special"?a.push(new me({subType:v,title:x.title,englishTitle:(M=x.title_english)!=null?M:x.title,year:(D=(b=x.year)!=null?b:(_=(m=(g=x.aired)==null?void 0:g.prop)==null?void 0:m.from)==null?void 0:_.year)!=null?D:"",dataSource:this.apiName,id:x.mal_id})):(v==="series"||v==="ova")&&a.push(new Pe({subType:v,title:x.title,englishTitle:(h=x.title_english)!=null?h:x.title,year:(E=(T=x.year)!=null?T:(S=(w=(y=x.aired)==null?void 0:y.prop)==null?void 0:w.from)==null?void 0:S.year)!=null?E:"",dataSource:this.apiName,id:x.mal_id}))}return a}async getById(t){var l,p,d,c,f,u,M,g,m,_,b,D,h,y,w,S,T,E,x,v,F,P,H,N,R,ee,_e,le,Se,gt,Le,Ge,$e,fe,We,Ye,De,yt,ei,Mt,ti,$t,ii,ri,Rt,At,oi,ni,Ee,ze,Ot,Nt,vt,Bt,It,Lt,Wt,$r,Rr,Ar;console.log(`MDB | api "${this.apiName}" queried by ID`);let i=`https://api.jikan.moe/v4/anime/${encodeURIComponent(t)}/full`,o=await fetch(i);if(o.status!==200)throw Error(`MDB | Received status code ${o.status} from an API.`);let n=await o.json();console.debug(n);let a=n.data,s=this.typeMappings.get((l=a.type)==null?void 0:l.toLowerCase());if(s===void 0)return new me({subType:"",title:a.title,englishTitle:(p=a.title_english)!=null?p:a.title,year:(M=(u=a.year)!=null?u:(f=(c=(d=a.aired)==null?void 0:d.prop)==null?void 0:c.from)==null?void 0:f.year)!=null?M:"",dataSource:this.apiName,url:a.url,id:a.mal_id,plot:a.synopsis,genres:(m=(g=a.genres)==null?void 0:g.map(te=>te.name))!=null?m:[],director:[],writer:[],studio:(b=(_=a.studios)==null?void 0:_.map(te=>te.name).join(", "))!=null?b:"unknown",duration:(D=a.duration)!=null?D:"unknown",onlineRating:(h=a.score)!=null?h:0,actors:[],image:(S=(w=(y=a.images)==null?void 0:y.jpg)==null?void 0:w.image_url)!=null?S:"",released:!0,premiere:(E=this.plugin.dateFormatter.format((T=a.aired)==null?void 0:T.from,this.apiDateFormat))!=null?E:"unknown",streamingServices:(v=(x=a.streaming)==null?void 0:x.map(te=>te.name))!=null?v:[],userData:{watched:!1,lastWatched:"",personalRating:0}});if(s==="movie"||s==="special")return new me({subType:s,title:a.title,englishTitle:(F=a.title_english)!=null?F:a.title,year:(ee=(R=a.year)!=null?R:(N=(H=(P=a.aired)==null?void 0:P.prop)==null?void 0:H.from)==null?void 0:N.year)!=null?ee:"",dataSource:this.apiName,url:a.url,id:a.mal_id,plot:a.synopsis,genres:(le=(_e=a.genres)==null?void 0:_e.map(te=>te.name))!=null?le:[],director:[],writer:[],studio:(gt=(Se=a.studios)==null?void 0:Se.map(te=>te.name).join(", "))!=null?gt:"unknown",duration:(Le=a.duration)!=null?Le:"unknown",onlineRating:(Ge=a.score)!=null?Ge:0,actors:[],image:(We=(fe=($e=a.images)==null?void 0:$e.jpg)==null?void 0:fe.image_url)!=null?We:"",released:!0,premiere:(De=this.plugin.dateFormatter.format((Ye=a.aired)==null?void 0:Ye.from,this.apiDateFormat))!=null?De:"unknown",streamingServices:(ei=(yt=a.streaming)==null?void 0:yt.map(te=>te.name))!=null?ei:[],userData:{watched:!1,lastWatched:"",personalRating:0}});if(s==="series"||s==="ova")return new Pe({subType:s,title:a.title,englishTitle:(Mt=a.title_english)!=null?Mt:a.title,year:(Rt=(ri=a.year)!=null?ri:(ii=($t=(ti=a.aired)==null?void 0:ti.prop)==null?void 0:$t.from)==null?void 0:ii.year)!=null?Rt:"",dataSource:this.apiName,url:a.url,id:a.mal_id,plot:a.synopsis,genres:(oi=(At=a.genres)==null?void 0:At.map(te=>te.name))!=null?oi:[],writer:[],studio:(Ee=(ni=a.studios)==null?void 0:ni.map(te=>te.name))!=null?Ee:[],episodes:a.episodes,duration:(ze=a.duration)!=null?ze:"unknown",onlineRating:(Ot=a.score)!=null?Ot:0,streamingServices:(vt=(Nt=a.streaming)==null?void 0:Nt.map(te=>te.name))!=null?vt:[],image:(Lt=(It=(Bt=a.images)==null?void 0:Bt.jpg)==null?void 0:It.image_url)!=null?Lt:"",released:!0,airedFrom:($r=this.plugin.dateFormatter.format((Wt=a.aired)==null?void 0:Wt.from,this.apiDateFormat))!=null?$r:"unknown",airedTo:(Ar=this.plugin.dateFormatter.format((Rr=a.aired)==null?void 0:Rr.to,this.apiDateFormat))!=null?Ar:"unknown",airing:a.airing,userData:{watched:!1,lastWatched:"",personalRating:0}})}};var Pi=class extends U{constructor(e){super(),this.plugin=e,this.apiName="MALAPI Manga",this.apiDescription="A free API for Manga. Some results may take a long time to load.",this.apiUrl="https://jikan.moe/",this.types=["manga"],this.typeMappings=new Map,this.typeMappings.set("manga","manga"),this.typeMappings.set("manhwa","manhwa"),this.typeMappings.set("doujinshi","doujin"),this.typeMappings.set("one-shot","oneshot"),this.typeMappings.set("manhua","manhua"),this.typeMappings.set("light novel","light-novel"),this.typeMappings.set("novel","novel")}async searchByTitle(e){var a,s,l,p,d,c,f,u,M,g,m,_,b,D,h,y,w,S,T,E,x;console.log(`MDB | api "${this.apiName}" queried by Title`);let t=`https://api.jikan.moe/v4/manga?q=${encodeURIComponent(e)}&limit=20${this.plugin.settings.sfwFilter?"&sfw":""}`,i=await fetch(t);if(console.debug(i),i.status!==200)throw Error(`MDB | Received status code ${i.status} from an API.`);let o=await i.json();console.debug(o);let n=[];for(let v of o.data){let F=this.typeMappings.get((a=v.type)==null?void 0:a.toLowerCase());n.push(new ct({subType:F,title:v.title,plot:v.synopsis,englishTitle:(s=v.title_english)!=null?s:v.title,alternateTitles:(p=(l=v.titles)==null?void 0:l.map(P=>P.title))!=null?p:[],year:(M=(u=v.year)!=null?u:(f=(c=(d=v.published)==null?void 0:d.prop)==null?void 0:c.from)==null?void 0:f.year)!=null?M:"",dataSource:this.apiName,url:v.url,id:v.mal_id,genres:(m=(g=v.genres)==null?void 0:g.map(P=>P.name))!=null?m:[],authors:(b=(_=v.authors)==null?void 0:_.map(P=>P.name))!=null?b:[],chapters:v.chapters,volumes:v.volumes,onlineRating:(D=v.score)!=null?D:0,image:(w=(y=(h=v.images)==null?void 0:h.jpg)==null?void 0:y.image_url)!=null?w:"",released:!0,publishedFrom:(T=new Date((S=v.published)==null?void 0:S.from).toLocaleDateString())!=null?T:"unknown",publishedTo:(x=new Date((E=v.published)==null?void 0:E.to).toLocaleDateString())!=null?x:"unknown",status:v.status,userData:{watched:!1,lastWatched:"",personalRating:0}}))}return n}async getById(e){var l,p,d,c,f,u,M,g,m,_,b,D,h,y,w,S,T,E,x,v,F,P,H;console.log(`MDB | api "${this.apiName}" queried by ID`);let t=`https://api.jikan.moe/v4/manga/${encodeURIComponent(e)}/full`,i=await fetch(t);if(i.status!==200)throw Error(`MDB | Received status code ${i.status} from an API.`);let o=await i.json();console.debug(o);let n=o.data,a=this.typeMappings.get((l=n.type)==null?void 0:l.toLowerCase());return new ct({subType:a,title:n.title,englishTitle:(p=n.title_english)!=null?p:n.title,alternateTitles:(c=(d=n.titles)==null?void 0:d.map(N=>N.title))!=null?c:[],year:(m=(g=n.year)!=null?g:(M=(u=(f=n.published)==null?void 0:f.prop)==null?void 0:u.from)==null?void 0:M.year)!=null?m:"",dataSource:this.apiName,url:n.url,id:n.mal_id,plot:(b=((_=n.synopsis)!=null?_:"unknown").replace(/"/g,"'"))!=null?b:"unknown",genres:(h=(D=n.genres)==null?void 0:D.map(N=>N.name))!=null?h:[],authors:(w=(y=n.authors)==null?void 0:y.map(N=>N.name))!=null?w:[],chapters:n.chapters,volumes:n.volumes,onlineRating:(S=n.score)!=null?S:0,image:(x=(E=(T=n.images)==null?void 0:T.jpg)==null?void 0:E.image_url)!=null?x:"",released:!0,publishedFrom:(F=new Date((v=n.published)==null?void 0:v.from).toLocaleDateString())!=null?F:"unknown",publishedTo:(H=new Date((P=n.published)==null?void 0:P.to).toLocaleDateString())!=null?H:"unknown",status:n.status,userData:{watched:!1,lastWatched:"",personalRating:0}})}};var Fi=class extends U{constructor(t){super();this.apiDateFormat="YYYY-MM-DDTHH:mm:ssZ";this.plugin=t,this.apiName="Wikipedia API",this.apiDescription="The API behind Wikipedia",this.apiUrl="https://www.wikipedia.com",this.types=["wiki"]}async searchByTitle(t){console.log(`MDB | api "${this.apiName}" queried by Title`);let i=`https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(t)}&srlimit=20&utf8=&format=json&origin=*`,o=await fetch(i);if(console.debug(o),o.status!==200)throw Error(`MDB | Received status code ${o.status} from an API.`);let n=await o.json();console.debug(n);let a=[];for(let s of n.query.search)a.push(new ut({type:"wiki",title:s.title,englishTitle:s.title,year:"",dataSource:this.apiName,id:s.pageid}));return a}async getById(t){var l;console.log(`MDB | api "${this.apiName}" queried by ID`);let i=`https://en.wikipedia.org/w/api.php?action=query&prop=info&pageids=${encodeURIComponent(t)}&inprop=url&format=json&origin=*`,o=await fetch(i);if(o.status!==200)throw Error(`MDB | Received status code ${o.status} from an API.`);let n=await o.json();console.debug(n);let a=Object.entries((l=n==null?void 0:n.query)==null?void 0:l.pages)[0][1];return new ut({type:"wiki",title:a.title,englishTitle:a.title,year:"",dataSource:this.apiName,url:a.fullurl,id:a.pageid,wikiUrl:a.fullurl,lastUpdated:this.plugin.dateFormatter.format(a.touched,this.apiDateFormat),length:a.length,userData:{}})}};var Cr=require("obsidian");var ki=class extends U{constructor(e){super(),this.plugin=e,this.apiName="MusicBrainz API",this.apiDescription="Free API for music albums.",this.apiUrl="https://musicbrainz.org/",this.types=["musicRelease"]}async searchByTitle(e){console.log(`MDB | api "${this.apiName}" queried by Title`);let t=`https://musicbrainz.org/ws/2/release-group?query=${encodeURIComponent(e)}&limit=20&fmt=json`,i=await(0,Cr.requestUrl)({url:t,headers:{"User-Agent":`${pr}/${cr} (${dr})`}});if(console.debug(i),i.status!==200)throw Error(`MDB | Received status code ${i.status} from an API.`);let o=await i.json;console.debug(o);let n=[];for(let a of o["release-groups"])n.push(new mt({type:"musicRelease",title:a.title,englishTitle:a.title,year:new Date(a["first-release-date"]).getFullYear().toString(),dataSource:this.apiName,url:"https://musicbrainz.org/release-group/"+a.id,id:a.id,image:"https://coverartarchive.org/release-group/"+a.id+"/front",artists:a["artist-credit"].map(s=>s.name),subType:a["primary-type"]}));return n}async getById(e){console.log(`MDB | api "${this.apiName}" queried by ID`);let t=`https://musicbrainz.org/ws/2/release-group/${encodeURIComponent(e)}?inc=releases+artists+tags+ratings+genres&fmt=json`,i=await(0,Cr.requestUrl)({url:t,headers:{"User-Agent":`${pr}/${cr} (${dr})`}});if(i.status!==200)throw Error(`MDB | Received status code ${i.status} from an API.`);let o=await i.json;console.debug(o);let n=o;return new mt({type:"musicRelease",title:n.title,englishTitle:n.title,year:new Date(n["first-release-date"]).getFullYear().toString(),dataSource:this.apiName,url:"https://musicbrainz.org/release-group/"+n.id,id:n.id,image:"https://coverartarchive.org/release-group/"+n.id+"/front",artists:n["artist-credit"].map(s=>s.name),genres:n.genres.map(s=>s.name),subType:n["primary-type"],rating:n.rating.value*2,userData:{personalRating:0}})}};var Pr=require("obsidian");var $i=class extends U{constructor(t){super();this.apiDateFormat="DD MMM, YYYY";this.plugin=t,this.apiName="SteamAPI",this.apiDescription="A free API for all Steam games.",this.apiUrl="http://www.steampowered.com/",this.types=["game"],this.typeMappings=new Map,this.typeMappings.set("game","game")}async searchByTitle(t){console.log(`MDB | api "${this.apiName}" queried by Title`);let o=await(0,Pr.requestUrl)({url:"http://api.steampowered.com/ISteamApps/GetAppList/v0002/?format=json"});if(o.status!==200)throw Error(`MDB | Received status code ${o.status} from an API.`);let n=await o.json;console.debug(n);let a=[];for(let l of n.applist.apps)if(l.name.normalize("NFD").replace(/\p{Diacritic}/gu,"").toLowerCase().includes(t.toLowerCase())&&a.push(l),a.length>20)break;let s=[];for(let l of a)s.push(new pe({type:"game",title:l.name,englishTitle:l.name,year:"",dataSource:this.apiName,id:l.appid}));return s}async getById(t){var s,l,p,d,c,f,u,M;console.log(`MDB | api "${this.apiName}" queried by ID`);let i=`http://store.steampowered.com/api/appdetails?appids=${encodeURIComponent(t)}&l=en`,o=await(0,Pr.requestUrl)({url:i});if(o.status!==200)throw Error(`MDB | Received status code ${o.status} from an API.`);console.debug(await o.json);let n;for(let[g,m]of Object.entries(await o.json))g===String(t)&&(n=m.data);if(!n)throw Error("MDB | API returned invalid data.");return console.debug(n),new pe({type:"game",title:n.name,englishTitle:n.name,year:new Date(n.release_date.date).getFullYear().toString(),dataSource:this.apiName,url:`https://store.steampowered.com/app/${n.steam_appid}`,id:n.steam_appid,developers:n.developers,publishers:n.publishers,genres:(l=(s=n.genres)==null?void 0:s.map(g=>g.description))!=null?l:[],onlineRating:Number.parseFloat((d=(p=n.metacritic)==null?void 0:p.score)!=null?d:0),image:(c=n.header_image)!=null?c:"",released:!((f=n.release_date)!=null&&f.comming_soon),releaseDate:(M=this.plugin.dateFormatter.format((u=n.release_date)==null?void 0:u.date,this.apiDateFormat))!=null?M:"unknown",userData:{played:!1,personalRating:0}})}};var Fr=require("obsidian");var Ri=class extends U{constructor(e){super(),this.plugin=e,this.apiName="BoardGameGeekAPI",this.apiDescription="A free API for BoardGameGeek things.",this.apiUrl="https://api.geekdo.com/xmlapi",this.types=["boardgame"]}async searchByTitle(e){var s,l,p,d;console.log(`MDB | api "${this.apiName}" queried by Title`);let t=`${this.apiUrl}/search?search=${encodeURIComponent(e)}`,i=await(0,Fr.requestUrl)({url:t});if(i.status!==200)throw Error(`MDB | Received status code ${i.status} from an API.`);let o=i.text,n=new window.DOMParser().parseFromString(o,"text/xml");console.debug(n);let a=[];for(let c of Array.from(n.querySelectorAll("boardgame"))){let f=c.attributes.getNamedItem("objectid").value,u=(l=(s=c.querySelector("name[primary=true]"))==null?void 0:s.textContent)!=null?l:c.querySelector("name").textContent,M=(d=(p=c.querySelector("yearpublished"))==null?void 0:p.textContent)!=null?d:"";a.push(new ft({dataSource:this.apiName,id:f,title:u,englishTitle:u,year:M}))}return a}async getById(e){var b,D,h,y,w,S,T,E,x,v,F,P,H,N;console.log(`MDB | api "${this.apiName}" queried by ID`);let t=`${this.apiUrl}/boardgame/${encodeURIComponent(e)}?stats=1`,i=await(0,Fr.requestUrl)({url:t});if(i.status!==200)throw Error(`MDB | Received status code ${i.status} from an API.`);let o=i.text,n=new window.DOMParser().parseFromString(o,"text/xml");console.debug(n);let a=n.querySelector("boardgame"),s=a.querySelector("name[primary=true]").textContent,l=(D=(b=a.querySelector("yearpublished"))==null?void 0:b.textContent)!=null?D:"",p=(y=(h=a.querySelector("image"))==null?void 0:h.textContent)!=null?y:void 0,d=Number.parseFloat((S=(w=a.querySelector("statistics ratings average"))==null?void 0:w.textContent)!=null?S:"0"),c=Array.from(a.querySelectorAll("boardgamecategory")).map(R=>R.textContent),f=Number.parseFloat((E=(T=a.querySelector("averageweight"))==null?void 0:T.textContent)!=null?E:"0"),u=Number.parseFloat((v=(x=a.querySelector("minplayers"))==null?void 0:x.textContent)!=null?v:"0"),M=Number.parseFloat((P=(F=a.querySelector("maxplayers"))==null?void 0:F.textContent)!=null?P:"0"),g=((N=(H=a.querySelector("playingtime"))==null?void 0:H.textContent)!=null?N:"unknown")+" minutes",m=Array.from(a.querySelectorAll("boardgamepublisher")).map(R=>R.textContent);return new ft({title:s,englishTitle:s,year:l==="0"?"":l,dataSource:this.apiName,url:`https://boardgamegeek.com/boardgame/${e}`,id:e,genres:c,onlineRating:d,complexityRating:f,minPlayers:u,maxPlayers:M,playtime:g,publishers:m,image:p,released:!0,userData:{played:!1,personalRating:0}})}};var Ai=class extends U{constructor(e){super(),this.plugin=e,this.apiName="OpenLibraryAPI",this.apiDescription="A free API for books",this.apiUrl="https://openlibrary.org/",this.types=["book"]}async searchByTitle(e){var a,s;console.log(`MDB | api "${this.apiName}" queried by Title`);let t=`https://openlibrary.org/search.json?title=${encodeURIComponent(e)}`,i=await fetch(t);if(console.debug(i),i.status!==200)throw Error(`MDB | Received status code ${i.status} from an API.`);let o=await i.json();console.debug(o);let n=[];for(let l of o.docs)n.push(new ht({title:l.title,englishTitle:(a=l.title_english)!=null?a:l.title,year:l.first_publish_year,dataSource:this.apiName,id:l.key,author:(s=l.author_name)!=null?s:"unknown"}));return n}async getById(e){var s,l,p,d,c,f,u,M,g;console.log(`MDB | api "${this.apiName}" queried by ID`);let t=`https://openlibrary.org/search.json?q=key:${encodeURIComponent(e)}`,i=await fetch(t);if(console.debug(i),i.status!==200)throw Error(`MDB | Received status code ${i.status} from an API.`);let o=await i.json();console.debug(o);let n=o.docs[0];return new ht({title:n.title,year:n.first_publish_year,dataSource:this.apiName,url:"https://openlibrary.org"+n.key,id:n.key,isbn:(l=((s=n.isbn)!=null?s:[]).find(m=>m.length<=10))!=null?l:"unknown",isbn13:(d=((p=n.isbn)!=null?p:[]).find(m=>m.length==13))!=null?d:"unknown",englishTitle:(c=n.title_english)!=null?c:n.title,author:(f=n.author_name)!=null?f:"unknown",plot:(u=n.description)!=null?u:"unknown",pages:(M=n.number_of_pages_median)!=null?M:"unknown",onlineRating:Number.parseFloat(Number((g=n.ratings_average)!=null?g:0).toFixed(2)),image:"https://covers.openlibrary.org/b/OLID/"+n.cover_edition_key+"-L.jpg",released:!0,userData:{read:!1,lastRead:"",personalRating:0}})}};var kr=require("obsidian");var Oi=class extends U{constructor(t){super();this.apiDateFormat="YYYY-DD-MM";this.plugin=t,this.apiName="MobyGamesAPI",this.apiDescription="A free API for games.",this.apiUrl="https://api.mobygames.com/v1",this.types=["game"]}async searchByTitle(t){console.log(`MDB | api "${this.apiName}" queried by Title`);let i=`${this.apiUrl}/games?title=${encodeURIComponent(t)}&api_key=${this.plugin.settings.MobyGamesKey}`,o=await(0,kr.requestUrl)({url:i});if(console.debug(o),o.status===401)throw Error(`MDB | Authentication for ${this.apiName} failed. Check the API key.`);if(o.status===429)throw Error(`MDB | Too many requests for ${this.apiName}, you've exceeded your API quota.`);if(o.status!==200)throw Error(`MDB | Received status code ${o.status} from an API.`);let n=await o.json;console.debug(n);let a=[];for(let s of n.games)a.push(new pe({type:"game",title:s.title,englishTitle:s.title,year:new Date(s.platforms[0].first_release_date).getFullYear().toString(),dataSource:this.apiName,id:s.game_id}));return a}async getById(t){var l,p,d,c;console.log(`MDB | api "${this.apiName}" queried by ID`);let i=`${this.apiUrl}/games?id=${encodeURIComponent(t)}&api_key=${this.plugin.settings.MobyGamesKey}`,o=await(0,kr.requestUrl)({url:i});if(console.debug(o),o.status!==200)throw Error(`MDB | Received status code ${o.status} from an API.`);let n=await o.json;console.debug(n);let a=n.games[0];return new pe({type:"game",title:a.title,englishTitle:a.title,year:new Date(a.platforms[0].first_release_date).getFullYear().toString(),dataSource:this.apiName,url:`https://www.mobygames.com/game/${a.game_id}`,id:a.game_id,developers:[],publishers:[],genres:(p=(l=a.genres)==null?void 0:l.map(f=>f.genre_name))!=null?p:[],onlineRating:a.moby_score,image:(d=a.sample_cover.image)!=null?d:"",released:!0,releaseDate:(c=a.platforms[0].first_release_date)!=null?c:"unknown",userData:{played:!1,personalRating:0}})}};var Ni=class{constructor(e){this.plugin=e}convertObject(e){if(!e.hasOwnProperty("type")||Fe.filter(o=>o.toString()==e.type).length<1)return e;let t=this.plugin.settings.propertyMappingModels.find(o=>o.type===e.type).properties,i={};for(let[o,n]of Object.entries(e))for(let a of t)if(a.property===o){a.mapping==="remap"?i[a.newProperty]=n:a.mapping==="remove"||a.mapping==="default"&&(i[o]=n);break}return i}convertObjectBack(e){if(!e.hasOwnProperty("type")||Fe.contains(e.type))return e;let t=this.plugin.settings.propertyMappingModels.find(o=>o.type===e.type).properties,i={};e:for(let[o,n]of Object.entries(e)){for(let a of t)if(a.property===o){i[o]=n;continue e}for(let a of t)if(a.newProperty===o){i[a.property]=n;continue e}}return i}};var ke=require("obsidian"),Bi=class extends ke.Modal{constructor(e,t,i){super(e),this.plugin=t,this.onSubmit=i,this.selectedApi=t.apiManager.apis[0].apiName}submit(){this.onSubmit(this.selectedApi,this.titleFieldName,this.appendContent),this.close()}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"Import folder as Media DB entries"});let t=e.createEl("div",{cls:"media-db-plugin-list-wrapper"});t.createEl("div",{cls:"media-db-plugin-list-text-wrapper"}).createEl("span",{text:"API to search",cls:"media-db-plugin-list-text"});let o=new ke.DropdownComponent(t);o.onChange(c=>{this.selectedApi=c});for(let c of this.plugin.apiManager.apis)o.addOption(c.apiName,c.apiName);t.appendChild(o.selectEl),e.createDiv({cls:"media-db-plugin-spacer"}),e.createEl("h3",{text:"Append note content to Media DB entry."});let n=e.createEl("div",{cls:"media-db-plugin-list-wrapper"});n.createEl("div",{cls:"media-db-plugin-list-text-wrapper"}).createEl("span",{text:"If this is enabled, the plugin will override metadata fields with the same name.",cls:"media-db-plugin-list-text"});let s=n.createEl("div",{cls:"media-db-plugin-list-toggle"}),l=new ke.ToggleComponent(n);l.setValue(!1),l.onChange(c=>this.appendContent=c),s.appendChild(l.toggleEl),e.createDiv({cls:"media-db-plugin-spacer"}),e.createEl("h3",{text:"The name of the metadata field that should be used as the title to query."});let p="title",d=new ke.TextComponent(e);d.inputEl.style.width="100%",d.setPlaceholder(p),d.onChange(c=>this.titleFieldName=c),d.inputEl.addEventListener("keydown",c=>{c.key==="Enter"&&this.submit()}),e.appendChild(d.inputEl),e.createDiv({cls:"media-db-plugin-spacer"}),new ke.Setting(e).addButton(c=>{c.setButtonText("Cancel"),c.onClick(()=>this.close()),c.buttonEl.addClass("media-db-plugin-button")}).addButton(c=>{c.setButtonText("Ok"),c.setCta(),c.onClick(()=>{this.submit()}),c.buttonEl.addClass("media-db-plugin-button"),this.searchBtn=c})}onClose(){let{contentEl:e}=this;e.empty()}};var be=require("obsidian");var Ii=class extends be.Modal{constructor(e,t){t=Object.assign({},Uo,t),super(e.app),this.plugin=e,this.selectedApis=[],this.title=t.modalTitle,this.query=t.prefilledSearchString;for(let i of this.plugin.apiManager.apis)this.selectedApis.push({name:i.apiName,selected:t.preselectedAPIs.contains(i.apiName)})}setSubmitCallback(e){this.submitCallback=e}setCloseCallback(e){this.closeCallback=e}keyPressCallback(e){e.key==="Enter"&&this.search()}async search(){if(!this.query||this.query.length<3){new be.Notice("MDB | Query too short");return}let e=this.selectedApis.filter(t=>t.selected).map(t=>t.name);if(e.length===0){new be.Notice("MDB | No API selected");return}this.isBusy||(this.isBusy=!0,this.searchBtn.setDisabled(!1),this.searchBtn.setButtonText("Searching..."),this.submitCallback({query:this.query,apis:e}))}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:this.title});let t="Search by title",i=new be.TextComponent(e);i.inputEl.style.width="100%",i.setPlaceholder(t),i.setValue(this.query),i.onChange(o=>this.query=o),i.inputEl.addEventListener("keydown",this.keyPressCallback.bind(this)),e.appendChild(i.inputEl),i.inputEl.focus(),e.createDiv({cls:"media-db-plugin-spacer"}),e.createEl("h3",{text:"APIs to search"});for(let o of this.plugin.apiManager.apis){let n=e.createEl("div",{cls:"media-db-plugin-list-wrapper"}),a=n.createEl("div",{cls:"media-db-plugin-list-text-wrapper"});a.createEl("span",{text:o.apiName,cls:"media-db-plugin-list-text"}),a.createEl("small",{text:o.apiDescription,cls:"media-db-plugin-list-text"});let s=n.createEl("div",{cls:"media-db-plugin-list-toggle"}),l=new be.ToggleComponent(s);l.setTooltip(o.apiName),l.setValue(this.selectedApis.find(p=>p.name===o.apiName).selected),l.onChange(p=>{this.selectedApis.find(d=>d.name===o.apiName).selected=p}),s.appendChild(l.toggleEl)}e.createDiv({cls:"media-db-plugin-spacer"}),new be.Setting(e).addButton(o=>{o.setButtonText("Cancel"),o.onClick(()=>this.close()),o.buttonEl.addClass("media-db-plugin-button")}).addButton(o=>{o.setButtonText("Ok"),o.setCta(),o.onClick(()=>{this.search()}),o.buttonEl.addClass("media-db-plugin-button"),this.searchBtn=o})}onClose(){this.closeCallback();let{contentEl:e}=this;e.empty()}};var we=require("obsidian");var Li=class extends we.Modal{constructor(e,t){t=Object.assign({},Ho,t),super(e.app),this.plugin=e,this.title=t.modalTitle,this.selectedApi=t.preselectedAPI||e.apiManager.apis[0].apiName}setSubmitCallback(e){this.submitCallback=e}setCloseCallback(e){this.closeCallback=e}keyPressCallback(e){e.key==="Enter"&&this.search()}async search(){if(!this.query){new we.Notice("MDB | no Id entered");return}if(!this.selectedApi){new we.Notice("MDB | No API selected");return}this.isBusy||(this.isBusy=!0,this.searchBtn.setDisabled(!1),this.searchBtn.setButtonText("Searching..."),this.submitCallback({query:this.query,api:this.selectedApi}))}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:this.title});let t="Search by id",i=new we.TextComponent(e);i.inputEl.style.width="100%",i.setPlaceholder(t),i.onChange(s=>this.query=s),i.inputEl.addEventListener("keydown",this.keyPressCallback.bind(this)),e.appendChild(i.inputEl),i.inputEl.focus(),e.createDiv({cls:"media-db-plugin-spacer"});let o=e.createEl("div",{cls:"media-db-plugin-list-wrapper"});o.createEl("div",{cls:"media-db-plugin-list-text-wrapper"}).createEl("span",{text:"API to search",cls:"media-db-plugin-list-text"});let a=new we.DropdownComponent(o);a.onChange(s=>{this.selectedApi=s});for(let s of this.plugin.apiManager.apis)a.addOption(s.apiName,s.apiName);o.appendChild(a.selectEl),e.createDiv({cls:"media-db-plugin-spacer"}),new we.Setting(e).addButton(s=>{s.setButtonText("Cancel"),s.onClick(()=>this.close()),s.buttonEl.addClass("media-db-plugin-button")}).addButton(s=>{s.setButtonText("Ok"),s.setCta(),s.onClick(()=>{this.search()}),s.buttonEl.addClass("media-db-plugin-button"),this.searchBtn=s})}onClose(){this.closeCallback();let{contentEl:e}=this;e.empty()}};var qi=require("obsidian");var Wi=class{constructor(e,t,i,o,n=!1){this.value=e,this.id=i,this.active=n,this.selectModal=o,this.cssClass="media-db-plugin-select-element",this.activeClass="media-db-plugin-select-element-selected",this.hoverClass="media-db-plugin-select-element-hover",this.element=t.createDiv({cls:this.cssClass}),this.element.id=this.getHTMLId(),this.element.on("click","#"+this.getHTMLId(),()=>{this.setActive(!this.active),this.selectModal.allowMultiSelect||this.selectModal.disableAllOtherElements(this.id)}),this.element.on("mouseenter","#"+this.getHTMLId(),()=>{this.setHighlighted(!0)}),this.element.on("mouseleave","#"+this.getHTMLId(),()=>{this.setHighlighted(!1)})}getHTMLId(){return`media-db-plugin-select-element-${this.id}`}isHighlighted(){return this.highlighted}setHighlighted(e){this.highlighted=e,this.highlighted?(this.addClass(this.hoverClass),this.selectModal.deHighlightAllOtherElements(this.id)):this.removeClass(this.hoverClass)}isActive(){return this.active}setActive(e){this.active=e,this.update()}update(){this.active?this.addClass(this.activeClass):this.removeClass(this.activeClass)}addClass(e){this.element.hasClass(e)||this.element.addClass(e)}removeClass(e){this.element.hasClass(e)&&this.element.removeClass(e)}};var ji=class extends qi.Modal{constructor(e,t,i=!0){super(e),this.allowMultiSelect=i,this.title="",this.description="",this.addSkipButton=!1,this.cancelButton=void 0,this.skipButton=void 0,this.submitButton=void 0,this.elementWrapper=void 0,this.elements=t,this.selectModalElements=[],this.scope.register([],"ArrowUp",o=>{this.highlightUp(),o.preventDefault()}),this.scope.register([],"ArrowDown",o=>{this.highlightDown(),o.preventDefault()}),this.scope.register([],"ArrowRight",()=>{this.activateHighlighted()}),this.scope.register([]," ",o=>{this.elementWrapper&&this.elementWrapper===document.activeElement&&(this.activateHighlighted(),o.preventDefault())}),this.scope.register([],"Enter",()=>this.submit())}disableAllOtherElements(e){for(let t of this.selectModalElements)t.id!==e&&t.setActive(!1)}deHighlightAllOtherElements(e){for(let t of this.selectModalElements)t.id!==e&&t.setHighlighted(!1)}async onOpen(){var n;let{contentEl:e,titleEl:t}=this;t.createEl("h2",{text:this.title}),e.addClass("media-db-plugin-select-modal"),e.createEl("p",{text:this.description}),this.elementWrapper=e.createDiv({cls:"media-db-plugin-select-wrapper"}),this.elementWrapper.tabIndex=0;let i=0;for(let a of this.elements){let s=new Wi(a,this.elementWrapper,i,this,!1);this.selectModalElements.push(s),this.renderElement(a,s.element),i+=1}(n=this.selectModalElements.first())==null||n.element.scrollIntoView();let o=new qi.Setting(e);o.addButton(a=>{a.setButtonText("Cancel"),a.onClick(()=>this.close()),a.buttonEl.addClass("media-db-plugin-button"),this.cancelButton=a}),this.addSkipButton&&o.addButton(a=>{a.setButtonText("Skip"),a.onClick(()=>this.skip()),a.buttonEl.addClass("media-db-plugin-button"),this.skipButton=a}),o.addButton(a=>{a.setButtonText("Ok"),a.setCta(),a.onClick(()=>this.submit()),a.buttonEl.addClass("media-db-plugin-button"),this.submitButton=a})}activateHighlighted(){for(let e of this.selectModalElements)e.isHighlighted()&&(e.setActive(!e.isActive()),this.allowMultiSelect||this.disableAllOtherElements(e.id))}highlightUp(){for(let e of this.selectModalElements)if(e.isHighlighted()){this.getPreviousSelectModalElement(e).setHighlighted(!0);return}this.selectModalElements.last().setHighlighted(!0)}highlightDown(){for(let e of this.selectModalElements)if(e.isHighlighted()){this.getNextSelectModalElement(e).setHighlighted(!0);return}this.selectModalElements.first().setHighlighted(!0)}getNextSelectModalElement(e){let t=e.id+1;return t=mi(t,this.selectModalElements.length),this.selectModalElements.filter(i=>i.id===t).first()}getPreviousSelectModalElement(e){let t=e.id-1;return t=mi(t,this.selectModalElements.length),this.selectModalElements.filter(i=>i.id===t).first()}};var Ui=class extends ji{constructor(e,t){t=Object.assign({},Vo,t),super(e.app,t.elements,t.multiSelect),this.plugin=e,this.title=t.modalTitle,this.description="Select one or multiple search results.",this.addSkipButton=t.skipButton,this.busy=!1,this.sendCallback=!1}setSubmitCallback(e){this.submitCallback=e}setCloseCallback(e){this.closeCallback=e}setSkipCallback(e){this.skipCallback=e}renderElement(e,t){t.createEl("div",{text:this.plugin.mediaTypeManager.getFileName(e)}),t.createEl("small",{text:`${e.getSummary()}
`}),t.createEl("small",{text:`${e.type.toUpperCase()+(e.subType?` (${e.subType})`:"")} from ${e.dataSource}`})}submit(){this.busy||(this.busy=!0,this.submitButton.setButtonText("Creating entry..."),this.submitCallback({selected:this.selectModalElements.filter(e=>e.isActive()).map(e=>e.value)}))}skip(){this.skipButton.setButtonText("Skipping..."),this.skipCallback()}onClose(){this.closeCallback()}};var Te=require("obsidian");var Ve=require("obsidian");var Hi=class extends Ve.Modal{constructor(e,t){t=Object.assign({},Go,t),super(e.app),this.plugin=e,this.title=t.modalTitle,this.elements=t.elements,this.markdownComponent=new Ve.Component}setSubmitCallback(e){this.submitCallback=e}setCloseCallback(e){this.closeCallback=e}async preview(){let{contentEl:e}=this;e.addClass("media-db-plugin-preview-modal"),e.createEl("h2",{text:this.title});let t=e.createDiv({cls:"media-db-plugin-preview-wrapper"});this.markdownComponent.load();for(let o of this.elements){t.createEl("h3",{text:o.englishTitle});let n=t.createDiv({cls:"media-db-plugin-preview"}),a=this.plugin.generateMediaDbNoteFrontmatterPreview(o);a=`\`\`\`yaml
${a}\`\`\``;try{await Ve.MarkdownRenderer.render(this.app,a,n,"",this.markdownComponent)}catch(s){console.warn("mdb | error during rendering of preview",s)}}e.createDiv({cls:"media-db-plugin-spacer"});let i=new Ve.Setting(e);i.addButton(o=>{o.setButtonText("Cancel"),o.onClick(()=>this.close()),o.buttonEl.addClass("media-db-plugin-button"),this.cancelButton=o}),i.addButton(o=>{o.setButtonText("Ok"),o.setCta(),o.onClick(()=>this.submitCallback({confirmed:!0})),o.buttonEl.addClass("media-db-plugin-button"),this.submitButton=o})}onOpen(){this.preview()}onClose(){this.markdownComponent.unload(),this.closeCallback()}};var xe=require("obsidian");var Vi=class extends xe.Modal{constructor(e,t){t=Object.assign({},Yo,t),super(e.app),this.plugin=e,this.selectedTypes=[],this.title=t.modalTitle,this.query=t.prefilledSearchString;for(let i of Fe)this.selectedTypes.push({name:i,selected:t.preselectedTypes.contains(i)})}setSubmitCallback(e){this.submitCallback=e}setCloseCallback(e){this.closeCallback=e}keyPressCallback(e){e.key==="Enter"&&this.search()}async search(){if(!this.query||this.query.length<3){new xe.Notice("MDB | Query too short");return}let e=this.selectedTypes.filter(t=>t.selected).map(t=>t.name);if(e.length===0){new xe.Notice("MDB | No Type selected");return}this.isBusy||(this.isBusy=!0,this.searchBtn.setDisabled(!1),this.searchBtn.setButtonText("Searching..."),this.submitCallback({query:this.query,types:e}))}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:this.title});let t="Search by title",i=new xe.TextComponent(e),o=null;i.inputEl.style.width="100%",i.setPlaceholder(t),i.setValue(this.query),i.onChange(n=>this.query=n),i.inputEl.addEventListener("keydown",this.keyPressCallback.bind(this)),e.appendChild(i.inputEl),i.inputEl.focus(),e.createDiv({cls:"media-db-plugin-spacer"}),e.createEl("h3",{text:"APIs to search"});for(let n of Fe){let a=e.createEl("div",{cls:"media-db-plugin-list-wrapper"});a.createEl("div",{cls:"media-db-plugin-list-text-wrapper"}).createEl("span",{text:zt(n),cls:"media-db-plugin-list-text"});let l=a.createEl("div",{cls:"media-db-plugin-list-toggle"}),p=new xe.ToggleComponent(l);p.setTooltip(zt(n)),p.setValue(this.selectedTypes.find(d=>d.name===n).selected),p.getValue()&&(o=p),p.onChange(d=>{d?(o&&o!==p&&(o.setValue(!1),this.selectedTypes.find(c=>c.name===n).selected=!1),o=p,this.selectedTypes.find(c=>c.name===n).selected=!0):(o=null,this.selectedTypes.find(c=>c.name===n).selected=!1)}),l.appendChild(p.toggleEl)}e.createDiv({cls:"media-db-plugin-spacer"}),new xe.Setting(e).addButton(n=>{n.setButtonText("Cancel"),n.onClick(()=>this.close()),n.buttonEl.addClass("media-db-plugin-button")}).addButton(n=>{n.setButtonText("Ok"),n.setCta(),n.onClick(()=>{this.search()}),n.buttonEl.addClass("media-db-plugin-button"),this.searchBtn=n})}onClose(){this.closeCallback();let{contentEl:e}=this;e.empty()}};var Yo={modalTitle:"Media DB Search",preselectedTypes:[],prefilledSearchString:""},Uo={modalTitle:"Media DB Advanced Search",preselectedAPIs:[],prefilledSearchString:""},Ho={modalTitle:"Media DB Id Search",preselectedAPI:"",prefilledSearchString:""},Vo={modalTitle:"Media DB Search Results",elements:[],multiSelect:!0,skipButton:!1},Go={modalTitle:"Media DB Preview",elements:[]},Gi=class{constructor(e){this.plugin=e}async createSearchModal(e){let t=new Vi(this.plugin,e);return{searchModalResult:await new Promise(o=>{t.setSubmitCallback(n=>o({code:0,data:n})),t.setCloseCallback(n=>{n&&o({code:3,error:n}),o({code:2})}),t.open()}),searchModal:t}}async openSearchModal(e,t){let{searchModalResult:i,searchModal:o}=await this.createSearchModal(e);if(console.debug(`MDB | searchModal closed with code ${i.code}`),i.code===3){console.warn(i.error),new Te.Notice(i.error.toString()),o.close();return}if(i.code!==2)try{let n=await t(i.data);return o.close(),n}catch(n){console.warn(n),new Te.Notice(n.toString()),o.close();return}}async createAdvancedSearchModal(e){let t=new Ii(this.plugin,e);return{advancedSearchModalResult:await new Promise(o=>{t.setSubmitCallback(n=>o({code:0,data:n})),t.setCloseCallback(n=>{n&&o({code:3,error:n}),o({code:2})}),t.open()}),advancedSearchModal:t}}async openAdvancedSearchModal(e,t){let{advancedSearchModalResult:i,advancedSearchModal:o}=await this.createAdvancedSearchModal(e);if(console.debug(`MDB | advencedSearchModal closed with code ${i.code}`),i.code===3){console.warn(i.error),new Te.Notice(i.error.toString()),o.close();return}if(i.code!==2)try{let n=await t(i.data);return o.close(),n}catch(n){console.warn(n),new Te.Notice(n.toString()),o.close();return}}async createIdSearchModal(e){let t=new Li(this.plugin,e);return{idSearchModalResult:await new Promise(o=>{t.setSubmitCallback(n=>o({code:0,data:n})),t.setCloseCallback(n=>{n&&o({code:3,error:n}),o({code:2})}),t.open()}),idSearchModal:t}}async openIdSearchModal(e,t){let{idSearchModalResult:i,idSearchModal:o}=await this.createIdSearchModal(e);if(console.debug(`MDB | idSearchModal closed with code ${i.code}`),i.code===3){console.warn(i.error),new Te.Notice(i.error.toString()),o.close();return}if(i.code!==2)try{let n=await t(i.data);return o.close(),n}catch(n){console.warn(n),new Te.Notice(n.toString()),o.close();return}}async createSelectModal(e){let t=new Ui(this.plugin,e);return{selectModalResult:await new Promise(o=>{t.setSubmitCallback(n=>o({code:0,data:n})),t.setSkipCallback(()=>o({code:1})),t.setCloseCallback(n=>{n&&o({code:3,error:n}),o({code:2})}),t.open()}),selectModal:t}}async openSelectModal(e,t){let{selectModalResult:i,selectModal:o}=await this.createSelectModal(e);if(console.debug(`MDB | selectModal closed with code ${i.code}`),i.code===3){console.warn(i.error),new Te.Notice(i.error.toString()),o.close();return}if(i.code!==2&&i.code!==1)try{let n=await t(i.data);return o.close(),n}catch(n){console.warn(n),new Te.Notice(n.toString()),o.close();return}}async createPreviewModal(e){let t=new Hi(this.plugin,e);return{previewModalResult:await new Promise(o=>{t.setSubmitCallback(n=>o({code:0,data:n})),t.setCloseCallback(n=>{n&&o({code:3,error:n}),o({code:2})}),t.open()}),previewModal:t}}async openPreviewModal(e,t){let{previewModalResult:i,previewModal:o}=await this.createPreviewModal(e);if(console.debug(`MDB | previewModal closed with code ${i.code}`),i.code===3){console.warn(i.error),new Te.Notice(i.error.toString()),o.close();return}if(i.code!==2)try{let n=await t(i.data);return o.close(),n}catch(n){console.warn(n),new Te.Notice(n.toString()),o.close();return}}};var kt=require("obsidian"),Yi=class{constructor(){this.toFormat="YYYY-MM-DD",this.locale=new Intl.DateTimeFormat().resolvedOptions().locale}setFormat(e){this.toFormat=e}getPreview(e){let t=(0,kt.moment)();return e||(e=this.toFormat),t.locale(this.locale).format(e)}format(e,t,i="en"){if(!e)return null;let o;return t?o=(0,kt.moment)(e,t,i):this.hasMomentFormat(e)?o=(0,kt.moment)(e):o=(0,kt.moment)(new Date(e)),o.isValid()?o.locale(this.locale).format(this.toFormat):null}hasMomentFormat(e){return(0,kt.moment)(e,!0).isValid()}};var zi=class extends K.Plugin{constructor(){super(...arguments);this.frontMatterRexExpPattern="^(---)\\n[\\s\\S]*?\\n---"}async onload(){this.apiManager=new Di,this.apiManager.registerAPI(new Ei(this)),this.apiManager.registerAPI(new Ci(this)),this.apiManager.registerAPI(new Pi(this)),this.apiManager.registerAPI(new Fi(this)),this.apiManager.registerAPI(new ki(this)),this.apiManager.registerAPI(new $i(this)),this.apiManager.registerAPI(new Ri(this)),this.apiManager.registerAPI(new Ai(this)),this.apiManager.registerAPI(new Oi(this)),this.mediaTypeManager=new _i,this.modelPropertyMapper=new Ni(this),this.modalHelper=new Gi(this),this.dateFormatter=new Yi,await this.loadSettings(),this.addSettingTab(new Si(this.app,this)),this.mediaTypeManager.updateTemplates(this.settings),this.mediaTypeManager.updateFolders(this.settings),this.dateFormatter.setFormat(this.settings.customDateFormat),this.addRibbonIcon("database","Add new Media DB entry",()=>this.createEntryWithAdvancedSearchModal()).addClass("obsidian-media-db-plugin-ribbon-class"),this.registerEvent(this.app.workspace.on("file-menu",(i,o)=>{o instanceof K.TFolder&&i.addItem(n=>{n.setTitle("Import folder as Media DB entries").setIcon("database").onClick(()=>this.createEntriesFromFolder(o))})})),this.addCommand({id:"open-media-db-search-modal",name:"Create Media DB entry",callback:()=>this.createEntryWithSearchModal()});for(let i of Fe)this.addCommand({id:`open-media-db-search-modal-with-${i}`,name:`Create Media DB entry (${zt(i)})`,callback:()=>this.createEntryWithSearchModal({preselectedTypes:[i]})});this.addCommand({id:"open-media-db-advanced-search-modal",name:"Create Media DB entry (advanced search)",callback:()=>this.createEntryWithAdvancedSearchModal()}),this.addCommand({id:"open-media-db-id-search-modal",name:"Create Media DB entry by id",callback:()=>this.createEntryWithIdSearchModal()}),this.addCommand({id:"update-media-db-note",name:"Update open note (this will recreate the note)",checkCallback:i=>this.app.workspace.getActiveFile()?(i||this.updateActiveNote(!1),!0):!1}),this.addCommand({id:"update-media-db-note-metadata",name:"Update metadata",checkCallback:i=>this.app.workspace.getActiveFile()?(i||this.updateActiveNote(!0),!0):!1}),this.addCommand({id:"add-media-db-link",name:"Insert link",checkCallback:i=>this.app.workspace.getActiveFile()?(i||this.createLinkWithSearchModal(),!0):!1})}async createLinkWithSearchModal(){let t=await this.modalHelper.openAdvancedSearchModal({},async a=>await this.apiManager.query(a.query,a.apis));if(!t)return;let i=await this.modalHelper.openSelectModal({elements:t,multiSelect:!1},async a=>await this.queryDetails(a.selected));if(!i||i.length<1)return;let o=`[${i[0].title}](${i[0].url})`,n=this.app.workspace.getActiveViewOfType(K.MarkdownView);n&&n.editor.replaceRange(o,n.editor.getCursor())}async createEntryWithSearchModal(t){let i=[],o=await this.modalHelper.openSearchModal(t!=null?t:{},async s=>{i=s.types;let l=this.apiManager.apis.filter(p=>p.hasTypeOverlap(s.types)).map(p=>p.apiName);try{return await this.apiManager.query(s.query,l)}catch(p){return console.warn(p),[]}});if(!o)return;o=o.filter(s=>i.contains(s.type));let n,a;for(;!a;){if(n=await this.modalHelper.openSelectModal({elements:o},async s=>await this.queryDetails(s.selected)),!n)return;a=await this.modalHelper.openPreviewModal({elements:n},async s=>s.confirmed)}await this.createMediaDbNotes(n)}async createEntryWithAdvancedSearchModal(){let t=await this.modalHelper.openAdvancedSearchModal({},async n=>await this.apiManager.query(n.query,n.apis));if(!t)return;let i,o;for(;!o;){if(i=await this.modalHelper.openSelectModal({elements:t},async n=>await this.queryDetails(n.selected)),!i)return;o=await this.modalHelper.openPreviewModal({elements:i},async n=>n.confirmed)}await this.createMediaDbNotes(i)}async createEntryWithIdSearchModal(){let t,i;for(;!i;){if(t=await this.modalHelper.openIdSearchModal({},async o=>await this.apiManager.queryDetailedInfoById(o.query,o.api)),!t)return;i=await this.modalHelper.openPreviewModal({elements:[t]},async o=>o.confirmed)}await this.createMediaDbNoteFromModel(t,{attachTemplate:!0,openNote:!0})}async createMediaDbNotes(t,i){for(let o of t)await this.createMediaDbNoteFromModel(o,{attachTemplate:!0,attachFile:i})}async queryDetails(t){let i=[];for(let o of t)try{i.push(await this.apiManager.queryDetailedInfo(o))}catch(n){console.warn(n),new K.Notice(n.toString())}return i}async createMediaDbNoteFromModel(t,i){try{console.debug("MDB | creating new note"),i.openNote=this.settings.openNoteInNewTab;let o=await this.generateMediaDbNoteContents(t,i);i.folder||(i.folder=await this.mediaTypeManager.getFolder(t,this.app));let n=await this.createNote(this.mediaTypeManager.getFileName(t),o,i);this.settings.enableTemplaterIntegration&&await po(this.app,n)}catch(o){console.warn(o),new K.Notice(o.toString())}}generateMediaDbNoteFrontmatterPreview(t){let i=this.modelPropertyMapper.convertObject(t.toMetaDataObject());return(0,K.stringifyYaml)(i)}async generateMediaDbNoteContents(t,i){let o=await this.mediaTypeManager.getTemplate(t,this.app);return this.generateContentWithDefaultFrontMatter(t,i,o)}async generateContentWithDefaultFrontMatter(t,i,o){let n;this.settings.useDefaultFrontMatter?n=this.modelPropertyMapper.convertObject(t.toMetaDataObject()):n={id:t.id,type:t.type,dataSource:t.dataSource};let a="";return o=i.attachTemplate?o:"",{fileMetadata:n,fileContent:a}=await this.attachFile(n,a,i.attachFile),{fileMetadata:n,fileContent:a}=await this.attachTemplate(n,a,o),this.settings.enableTemplaterIntegration&&hr(this.app)?a=`---
<%* const media = ${JSON.stringify(t)} %>
${(0,K.stringifyYaml)(n)}---
${a}`:a=`---
${(0,K.stringifyYaml)(n)}---
${a}`,a}async generateContentWithCustomFrontMatter(t,i,o){let n=new RegExp(this.frontMatterRexExpPattern),a=this.getMetaDataFromFileContent(o),s=o.replace(n,"");if(i.attachFile){let l=this.app.metadataCache.getFileCache(i.attachFile).frontmatter;s=await this.app.vault.read(i.attachFile),s=s.replace(n,""),s=s.startsWith(`
`)?s.substring(1):s,Object.keys(l).forEach(p=>{let d=l[p];!a[p]&&d&&(a[p]=d)})}return a.id||(a.id=t.id),a.type||(a.type=t.type),a.dataSource||(a.dataSource=t.dataSource),this.settings.enableTemplaterIntegration&&hr(this.app)?s=`---
<%* const media = ${JSON.stringify(t)} %>
${(0,K.stringifyYaml)(a)}---
${s}`:s=`---
${(0,K.stringifyYaml)(a)}---
${s}`,s}async attachFile(t,i,o){if(!o)return{fileMetadata:t,fileContent:i};let n=this.getMetadataFromFileCache(o);t=Object.assign(n,t);let a=await this.app.vault.read(o),s=new RegExp(this.frontMatterRexExpPattern);return a=a.replace(s,""),a=a.startsWith(`
`)?a.substring(1):a,i+=a,{fileMetadata:t,fileContent:i}}async attachTemplate(t,i,o){if(!o)return{fileMetadata:t,fileContent:i};let n=this.getMetaDataFromFileContent(o);t=Object.assign(n,t);let a=new RegExp(this.frontMatterRexExpPattern),s=o.replace(a,"");return i+=s,{fileMetadata:t,fileContent:i}}getMetaDataFromFileContent(t){let i,n=new RegExp(this.frontMatterRexExpPattern).exec(t);if(!n)return{};let a=n[0];return a?(a=a.substring(4),a=a.substring(0,a.length-3),i=(0,K.parseYaml)(a),i||(i={}),console.debug("MDB | metadata read from file content",i),i):{}}getMetadataFromFileCache(t){let i=this.app.metadataCache.getFileCache(t).frontmatter;return structuredClone(i!=null?i:{})}async createNote(t,i,o){var p;let n=(p=o.folder)!=null?p:this.app.vault.getAbstractFileByPath("/");t=no(t);let a=`${n.path}/${t}.md`,s=this.app.vault.getAbstractFileByPath(a);s&&await this.app.vault.delete(s);let l=await this.app.vault.create(a,i);if(console.debug(`MDB | created new file at ${a}`),o.openNote){let d=this.app.workspace.getUnpinnedLeaf();if(!d){console.warn("MDB | no active leaf, not opening newly created note");return}await d.openFile(l,{state:{mode:"source"}})}return l}async updateActiveNote(t=!1){let i=this.app.workspace.getActiveFile();if(!i)throw new Error("MDB | there is no active note");let o=this.getMetadataFromFileCache(i);if(o=this.modelPropertyMapper.convertObjectBack(o),console.debug("MDB | read metadata",o),!(o!=null&&o.type)||!(o!=null&&o.dataSource)||!(o!=null&&o.id))throw new Error("MDB | active note is not a Media DB entry or is missing metadata");let n=o,a=this.mediaTypeManager.createMediaTypeModelFromMediaType(n,n.type),s=await this.apiManager.queryDetailedInfoById(n.id,n.dataSource);s&&(s=Object.assign(a,s.getWithOutUserData()),t?await this.createMediaDbNoteFromModel(s,{attachFile:i,folder:i.parent,openNote:!0}):await this.createMediaDbNoteFromModel(s,{attachTemplate:!0,folder:i.parent,openNote:!0}))}async createEntriesFromFolder(t){let i=[],o=!1,{selectedAPI:n,titleFieldName:a,appendContent:s}=await new Promise(l=>{new Bi(this.app,this,(p,d,c)=>{l({selectedAPI:p,titleFieldName:d,appendContent:c})}).open()});for(let l of t.children)if(l instanceof K.TFile){let p=l;if(o){i.push({filePath:p.path,error:"user canceled"});continue}let c=this.getMetadataFromFileCache(p)[a];if(!c){i.push({filePath:p.path,error:`metadata field '${a}' not found or empty`});continue}let f=[];try{f=await this.apiManager.query(c,[n])}catch(m){i.push({filePath:p.path,error:m.toString()});continue}if(!f||f.length===0){i.push({filePath:p.path,error:"no search results"});continue}let{selectModalResult:u,selectModal:M}=await this.modalHelper.createSelectModal({elements:f,skipButton:!0,modalTitle:`Results for '${c}'`});if(u.code===3){i.push({filePath:p.path,error:u.error.message}),M.close();continue}if(u.code===2){i.push({filePath:p.path,error:"user canceled"}),M.close(),o=!0;continue}if(u.code===1){i.push({filePath:p.path,error:"user skipped"}),M.close();continue}if(u.data.selected.length===0){i.push({filePath:p.path,error:"no search results selected"});continue}let g=await this.queryDetails(u.data.selected);await this.createMediaDbNotes(g,s?p:null),M.close()}i.length>0&&await this.createErroredFilesReport(i)}async createErroredFilesReport(t){let i=`MDB - bulk import error report ${lo(new Date)}`,o=`${i}.md`,n=[["file","error"]].concat(t.map(s=>[s.filePath,s.error])),a=`# ${i}

${ao(n)}`;await this.app.vault.create(o,a)}async loadSettings(){let t=await this.loadData(),i=qo(this),o=Object.assign({},i,t),n=[];for(let a of i.propertyMappingModels){let s=o.propertyMappingModels.find(l=>l.type===a.type);if(s===void 0)n.push(a);else{let l=[];for(let p of a.properties){let d=s.properties.find(c=>c.property===p.property);d===void 0?l.push(p):l.push(new dt(d.property,d.newProperty,d.mapping,p.locked))}n.push(new Ft(s.type,l))}}o.propertyMappingModels=n,this.settings=o}async saveSettings(){this.mediaTypeManager.updateTemplates(this.settings),this.mediaTypeManager.updateFolders(this.settings),this.dateFormatter.setFormat(this.settings.customDateFormat),await this.saveData(this.settings)}};
